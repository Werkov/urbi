\documentclass[openright,twoside,12pt]{report}

% Number subsubsections
\setcounter{secnumdepth}{3}

% PACKAGES
\usepackage{a4wide}
\usepackage{afterpage}
\usepackage{graphicx}
\usepackage[utf8]{inputenc}
\usepackage{mycxx}
\usepackage{myhyperref}
\usepackage{mylistings}
\usepackage{xspace}
\usepackage{supertabular}

% SHORTHANDS
\newcommand{\ai}{AI\xspace}
\newcommand{\api}{API\xspace}
\newcommand{\caml}{Caml\xspace}
\newcommand{\io}{Io\xspace}
\newcommand{\java}{Java\xspace}
\newcommand{\js}{JavaScript\xspace}
\newcommand{\lua}{Lua}
\newcommand{\lisp}{Lisp}
\newcommand{\matlab}{MatLab\xspace}
\newcommand{\pascal}{PASCAL\xspace}
\newcommand{\python}{Python\xspace}
\newcommand{\ruby}{Ruby\xspace}
\newcommand{\sdk}{SDK\xspace}
\newcommand{\urbi}{Urbi\xspace}
\newcommand{\umake}{umake\xspace}
\newcommand{\us}{UrbiScript\xspace}

% LISTINGS

\lstset{language=[interactive]Urbi}

\definecolor{keywords}{rgb}{0.2,0.2,0.8}
\definecolor{comments}{rgb}{0.8,0.5,0}
\definecolor{string}{rgb}{0.0,0.5,0.0}
\definecolor{bg}{rgb}{0.9,0.9,1}

\lstset{
  keywordstyle=\color{keywords}\bfseries,
  commentstyle=\color{comments},
  stringstyle=\color{string},
  backgroundcolor=\color{bg},
  aboveskip=.6cm,
  captionpos=b,
  frame=single,
  basicstyle=\ttfamily,
  showstringspaces=false,
}

% COMMANDS
\newcommand{\lst}[1]{\autoref{lst:#1}}
\newcommand{\sect}[1]{\autoref{sect:#1}}
\newcommand{\tab}[1]{\autoref{tab:#1}}
\newcommand{\flushfloat}{\afterpage{\clearpage}}
\makeatletter
\renewcommand{\maketitle}{
  \begin{titlepage}

    \vfill

    \begin{figure}[htp]
      \centering
      \includegraphics[width=12cm]{img/urbi-logo}
    \end{figure}

    \begin{center}
      {\Huge\bf\@title\\}
      \vspace{1cm}
      {\Large \@author\\}
      \vspace{1cm}
      {\large \@date\\}
    \end{center}

    \vfill

    \begin{figure}[htp]
      \centering
      \includegraphics[width=12cm]{img/gostai}
    \end{figure}

    \vfill
    \global\let\title\relax
  \end{titlepage}
}
\makeatother

% STYLE
\hypersetup{colorlinks, citecolor=blue, linkcolor=blue, urlcolor=blue}

% CONFIGURATION
\title{\us 2.0 specifications}
\author{Kernel Team}

% DOCUMENT
\begin{document}

\maketitle
\tableofcontents

%FIXME: chapter is overkill
\chapter{Introduction}

\section{Status of this document}

This document defines the specifications of the \us language version
2.0. It defines the expected behavior from the \us interpreter, the
standard library, and the \sdk. It can be used to check that some code
is valid, or browse \us or \Cxx \api for a desired feature. Reading
some parts with no particular reason can also provide you with
advanced knowledge or subtleties about some \us aspects.

This document is however not fit to be used as a start guide to learn
\us, since it is not structured in a progressive manner and too
detailed. You can think of this document as a dictionary: one does not
% FIXME: give directions to the tutorials
learn a foreign language by reading a dictionary. The \us Tutorial, or
the live \us tutorial built in the interpreter are good introduction
to \us.

This document doesn't either aim at giving advanced programming
techniques. Its only goal is to defined how the language and its
libraries should behave.

\section{\us}

\us is an interpreted language designed for highly interactive and
parallel behavior programming. %FILLME

\section{Structuration of this document}

This document is divided in four chapters:

\begin{itemize}
\item Tools specifications: presentation and usage of the different
  tools available with the \urbi framework related to \us, such as the
  \urbi server, the command line client, \umake, \ldots
\item \us language specifications: definition of the core constructs
  of the language and their behavior.
\item \us standard library specifications: listing of all classes and
  methods provided in the standard library.
\item \urbi \sdk specifications: definition of the \urbi software
  development kit that enables you to interact with \urbi from \Cxx.
\end{itemize}

\chapter{Tools specifications}

\section{\urbi kernel}
\section{Console server}
\section{\umake}

\chapter{\us language specifications}

\section{Syntax}
\subsection{Comments}

Comments are used to document the code, and are totally ignored by the
\us interpreter. \Cxx-style and \C-style comments are supported.

\begin{itemize}
\item A \lstinline|//| introduces a comment that lasts until the end
  of the line.
\item A \lstinline|/*| introduces a comment that lasts until
  \lstinline|*/| is encountered. A difference with \C is that these
  comments nest; that is, if two \lstinline|/*| are encountered, the
  comment will end after two \lstinline|*/|, not one.
\end{itemize}

\lst{comments} illustrates this.

\begin{lstlisting}[caption=Comments,label=lst:comments,float=htp]
  // C++ style comment
  /* C style comment */
  /* These comments /* do */ nest */
\end{lstlisting}

\subsection{Identifiers}

Identifiers in \us are composed of one or more alphanumeric or
underscore (\lstinline|_|) characters, given that they must not start
with a digit. That is, identifiers must match the
\lstinline|[a-zA-Z_][a-zA-Z0-9_]*| regular expression (see
\lst{identifiers}).  Additionally, identifiers must not match any of
the \us reserved word which are documented in \sect{syn-key}. The only
exception to this rule is \lstinline|new|, which can be used as the
method identifier in a method call, as shown in
\lst{identifiers-keywords}.  Finally, identifiers can also be written
between simple quotes (\lstinline|'|), in which case they may contain
any characters, as in \lst{escape-identifiers}.

\begin{lstlisting}[caption=Identifiers,label=lst:identifiers,float=htp]
  var x;
  var foobar51;
  obj.met_hod();
  // Those are invalid.
// var 3x;
// obj.3x();
\end{lstlisting}

\begin{lstlisting}[caption=Identifiers cannot be keywords,
  label=lst:identifiers-keywords,float=htp]
  // Those are invalid because "if" is a keyword.
// var if;
// obj.if();
  // However, keywords can be escaped with simple quotes
  var 'if';
  obj.'if'();
\end{lstlisting}

\begin{lstlisting}[caption=Escaping identifiers with simple quotes,
  label=lst:escape-identifiers,float=htp]
  // Identifiers can be escaped with simple quotes
  var '#x';
  var '1 2 3';
  obj.'[]';
\end{lstlisting}

\subsection{Keywords}
\label{sect:syn-key}

Keywords are reserved words that cannot be used as identifiers, for
instance.  They are listed in \tab{keywords}.  Keywords can be
escaped, and thus used as identifier by surrounding them with simple
quotes (\lstinline|'|), as shown in \lst{escape-keyword}.

\renewcommand{\baselinestretch}{.85}
\begin{table}[htp]
  \caption{Keywords}
  \label{tab:keywords}
  \centering
  \begin{tabular}{|c|c||c|c|}
    \hline
    Keyword                       & Remark                                  &
    Keyword                       & Remark                                  \\
    \hline
    \lstinline"and"               & Synonym for  operator                   &
    \lstinline"long"              & Unused                                  \\
    \lstinline"and_eq"            & Synonym for  operator                   &
    \lstinline"loop"              & \lstinline|loop&| and
                                    \lstinline-loop|- flavors               \\
    \lstinline"asm"               & Unused                                  &
    \lstinline"loopn"             & Deprecated in favor of for              \\
    \lstinline"at"                &                                         &
    \lstinline"mutable"           & Unused                                  \\
    \lstinline"auto"              & Unused                                  &
    \lstinline"namespace"         & Unused                                  \\
    \lstinline"bitand"            & Synonym for \lstinline|&| operator      &
    \lstinline"new"               &                                         \\
    \lstinline"bitor"             & Synonym for \lstinline-|- operator      &
    \lstinline"not"               & Synonym for \lstinline|!| operator      \\
    \lstinline"bool"              & Unused                                  &
    \lstinline"not_eq"            & Synonym for \lstinline|!=| operator     \\
    \lstinline"break"             &                                         &
    \lstinline"object"            &                                         \\
    \lstinline"call"              &                                         &
    \lstinline"onleave"           &                                         \\
    \lstinline"case"              &                                         &
    \lstinline"or"                & Synonym for \lstinline-||- operator     \\
    \lstinline"catch"             & Unused                                  &
    \lstinline"or_eq"             & Synonym for \lstinline-|=- operator     \\
    \lstinline"char"              & Unused                                  &
    \lstinline"private"           & Ignored                                 \\
    \lstinline"class"             &                                         &
    \lstinline"protected"         & Ignored                                 \\
    \lstinline"closure"           &                                         &
    \lstinline"public"            & Ignored                                 \\
    \lstinline"compl"             & Synonym for \lstinline|~|               &
    \lstinline"register"          & Unused                                  \\
    \lstinline"const"             & Unused                                  &
    \lstinline"reinterpret_cast"  & Unnused                                 \\
    \lstinline"const_cast"        & Unused                                  &
    \lstinline"return"            &                                         \\
    \lstinline"continue"          &                                         &
    \lstinline"short"             & Unused                                  \\
    \lstinline"default"           & Unused                                  &
    \lstinline"signed"            & Unused                                  \\
    \lstinline"delete"            &                                         &
    \lstinline"sizeof"            & Unused                                  \\
    \lstinline"do"                &                                         &
    \lstinline"static"            & Deprecated                              \\
    \lstinline"double"            & Unused                                  &
    \lstinline"static_cast"       & Unused                                  \\
    \lstinline"dynamic_cast"      & Unused                                  &
    \lstinline"stopif"            &                                         \\
    \lstinline"else"              &                                         &
    \lstinline"struct"            & Unused                                  \\
    \lstinline"emit"              &                                         &
    \lstinline"switch"            &                                         \\
    \lstinline"enum"              & Unused                                  &
    \lstinline"template"          & Unused                                  \\
    \lstinline"event"             &                                         &
    \lstinline"this"              &                                         \\
    \lstinline"every"             &                                         &
    \lstinline"throw"             & Unused                                  \\
    \lstinline"explicit"          & Unused                                  &
    \lstinline"timeout"           &                                         \\
    \lstinline"export"            & Unused                                  &
    \lstinline"try"               & Unused                                  \\
    \lstinline"extern"            & Unused                                  &
    \lstinline"typedef"           & Unused                                  \\
    \lstinline"external"          &                                         &
    \lstinline"typeid"            & Unused                                  \\
    \lstinline"float"             & Unused                                  &
    \lstinline"typename"          & Unused                                  \\
    \lstinline"for"               & \lstinline|for&| and                    &
                                    \lstinline-for|- flavors
    \lstinline"union"             & Unused                                  \\
    \lstinline"foreach"           & Deprecated in favor of for              &
    \lstinline"unsigned"          & Unused                                  \\
    \lstinline"freezeif"          &                                         &
    \lstinline"using"             & Unused                                  \\
    \lstinline"friend"            & Unused                                  &
    \lstinline"var"               &                                         \\
    \lstinline"from"              &                                         &
    \lstinline"virtual"           & Unused                                  \\
    \lstinline"function"          &                                         &
    \lstinline"volatile"          & Unused                                  \\
    \lstinline"goto"              & Unused                                  &
    \lstinline"waituntil"         &                                         \\
    \lstinline"if"                &                                         &
    \lstinline"wchar_t"           & Unused                                  \\
    \lstinline"in"                &                                         &
    \lstinline"whenever"          &                                         \\
    \lstinline"inline"            & Unused                                  &
    \lstinline"while"             & \lstinline|while&| and
                                    \lstinline-while|- flavors              \\
    \lstinline"int"               & Unused                                  &
    inline"xor"                   & Synonym for \lstinline|^| operator      \\
    \lstinline"internal"          & Deprecated                              &
    \lstinline"xor_eq"            & Synonym \lstinline|^=| operator         \\
    \hline
  \end{tabular}
\end{table}
\renewcommand{\baselinestretch}{1}

\begin{lstlisting}[caption=Escaping keywords,label=lst:escape-keyword,float=htp]
  var 'if' = 21;
  [00000000] 21
  'if' * 2;
  [00000000] 42
\end{lstlisting}

\subsection{Literals}
\subsubsection{Durations}

Durations are floats (see \autoref{sect-syn-lit-flo}) followed by a
% FIXME: formulation
time unit. They are simply equivalent to the same float, expressed in
millisecond. For instance, \lstinline|1s|, which stands for ``one
second'', is strictly equivalent to \lstinline|1000|. Available units
and their equivalent are shown in \tab{durations}.

\begin{table}[htp]
  \caption{Duration units}
  \label{tab:durations}
  \centering
  \begin{tabular}{|c|c|c|}
    \hline
    unit        & abbreviation & equivalence for n         \\
    \hline
    millisecond & ms           & $n$                       \\
    second      & s            & $n * 1000$                \\
    minute      & m            & $n * 1000 * 60$           \\
    hour        & h            & $n * 1000 * 60 * 60$      \\
    day         & d            & $n * 1000 * 60 * 60 * 24$ \\
    \hline
  \end{tabular}
\end{table}

\subsubsection{Floats}
\label{sect-syn-lit-flo}

Literal floats consist in a succession of digit, representing the
integral part of the number in decimal base, possibly followed by a
dot (\lstinline|.|) and another succession of digit representing the
decimal part. Briefly, float literals must verify the
\lstinline|[0-9]+(\.[0-9]+)?| regular expression. \lst{literal-floats}
is an example of literal floats.

\begin{lstlisting}[caption=Literal floats,label=lst:literal-floats,float=htp]
  1;
  [00000000] 1
  1.1;
  [00000000] 1.1
\end{lstlisting}

\subsubsection{Lists}

Literal lists are represented with a comma-separated, potentially
empty list of arbitrary expressions enclosed in square brackets
(\lstinline|[]|), as shown in \lst{literal-lists}.

\begin{lstlisting}[caption=Literal lists,label=lst:literal-lists,float=htp]
  []; // The empty list
  [00000000] []
  [1, 2, 3];
  [00000000] [1, 2, 3]
\end{lstlisting}

\subsubsection{Strings}

String are enclosed in double quotes (\lstinline|"|) and can contain
arbitrary characters, which stand for themselves, with the exception
of the escapement character, backslash (\lstinline|\|), as we can see
in \lst{literal-strings}. Backslash can introduce the following escapements:

\begin{itemize}
  \item \lstinline |\\|: an actual backslash
  \item \lstinline|\a|: a bell ring
  \item \lstinline|\b|: a backspace
  \item \lstinline|\f|: a form feed
  \item \lstinline|\n|: a line feed
  \item \lstinline|\r|: a carriage return
  \item \lstinline|\t|: a tabulation
  \item \lstinline|\v|: a vertical tabulation
\end{itemize}

Note that the interpreter print escaped strings. That is, line feed
will be printed out as \lstinline|\n| when a string result is
dumped. An actual line feed will of course be output if a string
content is printed with echo for instance.

\begin{lstlisting}[caption=Literal strings,label=lst:literal-strings,float=htp]
  "";
  [00000000] ""
  "foo";
  [00000000] ""
  "a\nb"; // UrbiScript escapes string when dumping them
  [00000000] "a\nb"
  echo("a\nb"); // We can see there is an actual line feed
  [00000000] *** a
  ..b
  echo("a\\nb");
  [00000000] a\nb
\end{lstlisting}

\section{Local variables}
\section{Objects}
\section{Flow control}
\section{Parallelism}
\section{Events}
\section{Pattern matching}
\section{Trajectories}

\chapter{\us standard library specifications}

\section{Boolean}
\section{Channel}
\section{Code}
\section{Comparable}
\section{Dictionary}
\section{Event}
\section{Float}
\section{Group}
\section{Integer}
\section{Lazy}
\section{List}
\section{Lobby}
\section{Object}
\section{Orderable}
\section{Pattern}
\section{Primitive}
\section{String}
\section{Tag}
\section{Tuple}

\chapter{\urbi SDK specifications}

% I just don't know
% what to do
% with myself

\end{document}

% printing, operators, waituntil

% LocalWords:  Urbi monomethods netcat cosinus timestamp subscopes subscope lst
% LocalWords:  getSlot setSlot updateSlot slotNames removeSlot uid arg ok ko ss
% LocalWords:  elt baz quux FIXME getslot lookup protos proto addProto asString
% LocalWords:  removeProto locateSlot locateslot lhs evalArgAt evalArgs ary
% LocalWords:  mytag timeOut myEvent Tuple
