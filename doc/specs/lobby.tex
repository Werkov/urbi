\section{Lobby}

A \dfn{lobby} is the local environment for each (remote or local)
connection to an \urbi server.

\subsection{Prototypes}
\begin{itemize}
\item \lstinline|Channel.topLevel|, an instance of \refObject{Channel}
  with an empty Channel name.
\end{itemize}

\subsection{Construction}

A lobby is implicitly created at each connection. At the top level,
\lstinline|this| is a \dfn{Lobby}.

\begin{urbiscript}
this.protos;
[00000001] [Lobby]
this.protos[0].protos;
[00000003] [Channel_0xADDR]
\end{urbiscript}

Lobbies cannot be cloned, they must be created using
\lstinline|create|.

\begin{urbiscript}
Lobby.new;
[00000177:error] !!! new: `Lobby' objects cannot be cloned
Lobby.create;
[00000174] Lobby_0x126450
\end{urbiscript}


\subsection{Examples}

Since every lobby is-a \refObject{Channel}, one can use the methods of
Channel.

\begin{urbiscript}
lobby << 123;
[00478679] 123
lobby << "foo";
[00478679] "foo"
\end{urbiscript}

\subsection{Slots}
\begin{urbiscriptapi}
\item[banner] Internal.  Display \urbi SDK banner.
\begin{urbiscript}
lobby.banner;
[00000011] *** *****************************************************************
[00000012] *** Urbi SDK version 2.0/rc-4 rev. e594893
[00000013] *** Copyright (C) 2005-2010 Gostai SAS
[00000014] ***
[00000015] *** This program comes with ABSOLUTELY NO WARRANTY.  It can be used
[00000016] *** under certain conditions; see the LICENSE.txt file for details.
[00000017] ***
[00000018] *** Check our community site: http://www.urbiforge.org.
[00000019] *** *****************************************************************
\end{urbiscript}

\item[connected]
  Whether \lstinline|this| is connected.
\begin{urbiassert}
connected;
\end{urbiassert}

\item[connectionTag]
  The tag of all code executed in the context of \lstinline|this|.

\item \lstinline|copyright(var \var{deep} = true)|~\\
  Internal.  Display the copyright of \urbi SDK.  Include copyright
  information about sub-components if \var{deep}.
\begin{urbiscript}
lobby.copyright(false);
[00000022] *** Urbi SDK version 2.0/rc-4 rev. e594893
[00000023] *** Copyright (C) 2005-2010 Gostai SAS

lobby.copyright(true);
[00000024] *** Urbi SDK version 2.0/rc-4 rev. e594893
[00000025] *** Copyright (C) 2005-2010 Gostai SAS
[00000027] ***
[00000028] *** Urbi SDK Remote version preview/1.6/rc-1 rev. cab1787
[00000029] *** Copyright (C) 2005-2010 Gostai SAS
[00000031] ***
[00000032] *** Libport version releases/1.0 rev. 88f9f61
[00000033] *** Copyright (C) 2005-2010 Gostai SAS
\end{urbiscript}

\item[create]
  Instantiate a new Lobby.
\begin{urbiassert}
Lobby.create;
\end{urbiassert}

\item \lstinline|echo(\var{value}, \var{channel} = "")|\\
  Send \lstinline|\var{value}.asString| to \lstinline|this|, prefixed
  by the \refObject{String} \var{channel} name if specified.  This is
  the preferred way to send informative messages (prefixed with
  \samp{***}).
\begin{urbiscript}
lobby.echo("111", "foo");
[00015895:foo] *** 111
lobby.echo(222, "");
[00051909] *** 222
lobby.echo(333);
[00055205] *** 333
\end{urbiscript}

%\item \lstinline|help|\experimental\\
%  Launch the tutorial.

\item[lobby]
  Return the current lobby, i.e., \lstinline|this|.
\begin{urbiassert}
lobby === this;
\end{urbiassert}

\item \lstinline|onDisconnect(\var{lobby})|\\
  Event launched when \lstinline|this| has disconnected.

\item[quit] Shut this lobby down, i.e., close the connection.  The
  server is still running, see \lstinline|System.shutdown| to quit the
  server.

\item \lstinline|receive(\var{value})|\\
  This is low-level routine.  Pretend the \refObject{String}
  \var{value} was received from the connection.  There is no guarantee
  that \var{value} will be the next program block that will be
  processed: for instance, if you load a file which, in its middle,
  uses \lstinline|lobby.receive("foo")|, then \lstinline|"foo"| will
  be appended after the end of the file.
\begin{urbiscript}
Lobby.create.receive("12;");
[00478679] 12
\end{urbiscript}

\item \lstinline|send(\var{value}, \var{channel} = "")|\\
  This is low-level routine.  Send the \refObject{String} \var{value}
  to \lstinline|this|, prefixed by the \refObject{String}
  \var{channel} name if specified.
\begin{urbiscript}
lobby.send("111", "foo");
[00015895:foo] 111
lobby.send("222", "");
[00051909] 222
lobby.send("333");
[00055205] 333
\end{urbiscript}

\item \lstinline|wall(\var{value}, \var{channel} = "")|\\
  Perform \lstinline|echo(\var{value}, \var{channel})| on all the
  existing lobbies (except Lobby itself).
\begin{urbiscript}[firstnumber=1]
Lobby.wall("111", "foo");
[00015895:foo] *** 111

Lobby.create|;
Lobby.wall(222, "");
[00051909] *** 222
[00051909] *** 222

Lobby.create|;
Lobby.create|;
Lobby.wall(333);
[00055205] *** 333
[00055205] *** 333
[00055205] *** 333
[00055205] *** 333
\end{urbiscript}

\item \lstinline|write(\var{value})|\\
  This is low-level routine.  Send the \refObject{String} \var{value}
  to the connection.  Note that because of buffering, the output might
  not be visible before an end-of-line character is output.
\begin{urbiscript}
lobby.write("[");
lobby.write("999999999:");
lobby.write("myTag] ");
lobby.write("Hello, World!");
lobby.write("\n");
[999999999:myTag] Hello, World!
\end{urbiscript}
\end{urbiscriptapi}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "../urbi-sdk"
%%% ispell-dictionary: "american"
%%% ispell-personal-dictionary: "../urbi.dict"
%%% End:
