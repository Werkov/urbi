\section{Tag}

A Tag is an object which you can use to label blocks of code in order
to control them externally.  Tagged code can be freezed, resumed,
stopped\ldots See also \autoref{sec:tut:tags}.

\subsection{Construction}
\label{stdlib:tag:ctor}

Tags are objects, and must be created as any object by using
\lstinline{new} to create derivatives of the \lstinline{Tag} object.
The name is optional, it makes easier to display a tag and remember
what it is.

\begin{urbiscript}
// Anonymous tag.
var t1 = Tag.new;
[00000001] Tag<tag_8>

// Named tag.
var t2 = Tag.new("cool name");
[00000001] Tag<cool name>
\end{urbiscript}

\subsection{Examples}

\subsubsection{Block/unblock}
\label{sec:specs:tag:block}

To \dfn{block} a tag means:
\begin{itemize}
\item Stop running pieces of code it labels.
\item Ignore new pieces of code it labels.
\end{itemize}

One can \dfn{unblock} the tag.  Contrary to
\lstinline|freeze|/\lstinline|unfreeze|, tagged code does the resume
the execution.


\begin{urbiscript}
var ping = Tag.new("ping")|;
ping:
  every (1s)
    echo("ping"),
assert(!ping.blocked);
sleep(2.1s);
[00000000] *** ping
[00002000] *** ping

ping.block;
assert(ping.blocked);

ping:
  every (1s)
    echo("pong"),

// Neither new nor old code runs.
ping.unblock;
assert(!ping.blocked);
sleep(2.1s);

// But we can use the tag again.
ping:
  every (1s)
    echo("ping again"),
sleep(2.1s);
[00004000] *** ping again
[00005000] *** ping again
[00006000] *** ping again
\end{urbiscript}

\subsubsection{Freeze/unfreeze}
\label{sec:specs:tag:freeze}

To \dfn{freeze} a tag means holding the execution of code it labels.
This applies to code already being run, and ``arriving'' pieces of code.

\begin{urbiscript}
var t = Tag.new|;
var t0 = time|;
t: every(1s) echo("time   : %.0f" % (time - t0)),
sleep(2.2s);
[00000158] *** time   : 0
[00001159] *** time   : 1
[00002159] *** time   : 2

t.freeze;
assert(t.frozen);
t: every(1s) echo("shifted: %.0f" % (shiftedTime - t0)),
sleep(2.2s);
// The tag is frozen, nothing is run.

// Unfreeze the tag: suspended code is resumed.
// Note the difference between "time" and "shiftedTime".
t.unfreeze;
assert(!t.frozen);
sleep(2.2s);
[00004559] *** shifted: 2
[00005361] *** time   : 5
[00005560] *** shifted: 3
[00006362] *** time   : 6
[00006562] *** shifted: 4
\end{urbiscript}


\subsection{Methods}

\begin{itemize}
\item \lstinline|block|~\\
  Block any code tagged by \lstinline|this|.  Blocked tags can be
  unblocked using \lstinline|Tag.unblock|.  See
  \autoref{sec:specs:tag:block}.

\item \lstinline|blocked|~\\
  Whether code tagged by \lstinline|this| is blocked.  See
  \autoref{sec:specs:tag:block}.

\item \lstinline|freeze|~\\
  Suspend code tagged by \lstinline|this|, already running or
  forthcoming.  Frozen code can be later unfrozen using
  \lstinline|Tag.unfreeze|.  See \autoref{sec:specs:tag:freeze}.

\item \lstinline|frozen|~\\
  Whether the tag is frozen. See  \autoref{sec:specs:tag:freeze}.

\item \lstinline|stop|~\\
  Stop any code tagged by \lstinline|this|.

\item \lstinline|unblock|~\\
  Unblock \lstinline|this|.  See \autoref{sec:specs:tag:block}.

\item \lstinline|unfreeze|~\\
  Unfreeze code tagged by \lstinline|this|.  See
  \autoref{sec:specs:tag:freeze}.
\end{itemize}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "../urbi-sdk"
%%% End:
