%% Copyright (C) 2009-2010, Gostai S.A.S.
%%
%% This software is provided "as is" without warranty of any kind,
%% either expressed or implied, including but not limited to the
%% implied warranties of fitness for a particular purpose.
%%
%% See the LICENSE file for more information.

\section{Code}

Functions written in \us.

\subsection{Prototypes}

\begin{refObjects}
\item[Comparable]
\item[Executable]
\item[Object]
\end{refObjects}

\subsection{Construction}

The keywords \lstinline|function| and \lstinline|closure| build Code
instances.

\begin{urbiassert}
function(){}.protos[0] === getSlot("Code");
closure(){}.protos[0] === getSlot("Code");
\end{urbiassert}

\subsection{Slots}

\begin{urbiscriptapi}
\item \lstinline|==(\var{that})|\\
  Whether \lstinline|this| and \var{that} are the same source code.
  It actually checks that both have the same \lstinline|asString|.
\begin{urbiassert}
function () { 1 } == function () { 1 };
function () { 1 } != closure  () { 1 };
closure  () { 1 } != function () { 1 };

function () { 1 + 1 } == function () { 1 + 1 };
function () { 1 + 2 } != function () { 2 + 1 };

function () { 1 } != function { 1 };
function () { 1 } != function (ignored) { 1 };
\end{urbiassert}

\item \lstinline|apply(\var{args})|\\
  Invoke the routine, with all the arguments.  The target,
  \lstinline|this|, will be set to \lstinline|\var{args}[0]| and the
  remaining arguments with be given as arguments.
\begin{urbiassert}
function (x, y) { x+y }.apply([nil, 10, 20]) == 30;
function () { this }.apply([123]) == 123;

// There is Object.apply.
1.apply([this]) == 1;
\end{urbiassert}
\begin{urbiscript}
function () {}.apply([]);
[00000001:error] !!! apply: list of arguments must begin with `this'

function () {}.apply([1, 2]);
[00000002:error] !!! apply: expected 0 argument, given 1
\end{urbiscript}

\item[asString]
  Conversion to \refObject{String}.
\begin{urbiassert}
closure  () { 1 }.asString == "closure () {\n  1\n}";
function () { 1 }.asString == "function () {\n  1\n}";
\end{urbiassert}

\item[bodyString]
  Conversion to \refObject{String} of the routine body.
\begin{urbiassert}
closure  () { 1 }.bodyString == "1";
function () { 1 }.bodyString == "1";
\end{urbiassert}

\end{urbiscriptapi}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "../urbi-sdk"
%%% ispell-dictionary: "american"
%%% ispell-personal-dictionary: "../urbi.dict"
%%% fill-column: 76
%%% End:
