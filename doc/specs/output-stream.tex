%% Copyright (C) 2009-2010, Gostai S.A.S.
%%
%% This software is provided "as is" without warranty of any kind,
%% either expressed or implied, including but not limited to the
%% implied warranties of fitness for a particular purpose.
%%
%% See the LICENSE file for more information.

\section{OutputStream}

OutputStreams are used to write (possibly binary) files by hand.

\subsection{Prototypes}
\begin{refObjects}
\item[Object]
\end{refObjects}

\subsection{Construction}

An OutputStream is a writing-interface to a file; its constructor
requires a \refObject{File}.  If the file already exists, content is
\emph{appended} to it.  Remove the file beforehand if you want to
override its content.

\begin{urbiscript}
OutputStream.new(File.create("file.txt"));
[00000001] OutputStream_0x827000

OutputStream.new(File.new("file.txt"));
[00000002] OutputStream_0x827000
\end{urbiscript}

\subsection{Slots}

\begin{urbiscriptapi}
\item[<<](<that>)%
  Output \lstinline|\var{this}.asString|.  Return \this to
  enable chains of calls.
\begin{urbiscript}
var o = OutputStream.new(File.create("fresh.txt"))|;
o << 1 << "2" << [3, [4]]|;

assert (File.new("fresh.txt").content.data == "12[3, [4]]");
\end{urbiscript}

\item[close]
  Flush the buffers, and close the file.
\begin{urbiassert}
OutputStream.new(File.create("close.txt")).close.isVoid;
\end{urbiassert}

\item[flush]%
  To provide efficient input/output operations, \dfn[buffer]{buffers} are
  used.  As a consequence, what is put into a stream might not be
  immediately saved on the actual file.  To \dfn{flush} a buffer means to
  dump its content to the file.
\begin{urbiassert}
OutputStream.new(File.create("file.txt")).flush.isVoid;
\end{urbiassert}

\item[put](<byte>)%
  Output the character corresponding to the numeric code \var{byte} in
  \this, and return \this.
\begin{urbiscript}[firstnumber=1]
var f = File.create("put.txt") |
var o = OutputStream.new(f) |

assert
{
  o.put(0)
   .put(255)
   .put(72).put(101).put(108).put(108).put(111)
  === o;
  o.close.isVoid;
  f.content.data == "\0\xffHello";
};
o.put(12.5);
[00029816:error] !!! put: bad numeric conversion: overflow or non empty fractional part: 12.5
o.put(-1);
[00034840:error] !!! put: bad numeric conversion: negative overflow: -1
o.put(256);
[00039175:error] !!! put: bad numeric conversion: positive overflow: 256
\end{urbiscript}

\end{urbiscriptapi}


%%% Local Variables:
%%% mode: latex
%%% TeX-master: "../urbi-sdk"
%%% ispell-dictionary: "american"
%%% ispell-personal-dictionary: "../urbi.dict"
%%% fill-column: 76
%%% End:
