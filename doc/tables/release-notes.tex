\chapter{Release Notes}
\label{sec:news}

This section lists the user-visible changes in the releases of \urbi
SDK.

\section{\urbi SDK 2.0}

\subsection{\us}

\subsubsection{Changes}

\begin{itemize}
\item \slot{Global}{Tags} is renamed as \refSlot{Tag}{tags}.

\item \slot{Global}{Task} is renamed as \refSlot{Global}{Job}.

\item \slot{Global}{topLevel} is renamed as \refSlot{Channel}{topLevel}.

\item \slot{Global}{output}, \slot{Global}{error} are removed, they were
  deprecated in favor of \refSlot{Global}{cout} and \refSlot{Global}{cerr}.

\item \refSlot{Object}{getPeriod} is deprecated in favor of
  \refSlot{System}{period}.

\item As announced long ago, and as displayed by warnings,
  \refSlot{Object}{slotNames} now returns all the slot names, ancestors
  included.  Use \refSlot{Object}{localSlotNames} to get the list of the
  names of the slot the object owns.

\item \refSlot{Semaphore}{acquire} and \refSlot{Semaphore}{release} are
  promoted over \refSlot{Semaphore}{p} and \refSlot{Semaphore}{v}.
\end{itemize}

\subsubsection{New features}

\begin{itemize}
\item Dictionary can now be created with literals.

  \begin{center}
    \begin{tabular}{|c|c|}
      \hline
      Syntax & Semantics\\
      \hline
      \lstinline|[ => ]|
      &
      \lstinline|Dictionary.new|
      \\
      \lstinline|["a" => 1, "b" => 2, "c" => 3]|
      &
      \lstinline|Dictionary.new("a", 1, "b", 2, "c", 3)|
      \\
      \hline
    \end{tabular}
  \end{center}

\item \refSlot{Float}{srandom}
\item \refSlot{List}{subset}
\item \refSlot{Object}{getLocalSlot}.
\item String escapes accept one- and two-digit octal numbers.
  For instance \lstinline|"\0"|, \lstinline|"\00"| and
  \lstinline|"\000"| all denote the same value.

\item Tuple can now be created with literals.

  \begin{center}
    \begin{tabular}{|c|c|}
      \hline
      Syntax & Semantics\\
      \hline
      \lstinline|()|        & \lstinline|Tuple.new([])| \\
      \lstinline|(1,)|      & \lstinline|Tuple.new([1])| \\
      \lstinline|(1, 2, 3)| & \lstinline|Tuple.new([1, 2, 3])| \\
      \hline
    \end{tabular}
  \end{center}

\item Location.'=='.

\item type replaces \lstinline|'$type'|
\end{itemize}

\subsection{UObjects}

\begin{itemize}
\item Remote timers (USetUpdate, USetTimer) are now handled locally
  instead of by the kernel.
\item UVars can be copied using the \refSlot{UVar}{copy} method.
\item New UEvent class, similar to UVar. Can be used to emit events.
\item Added support for dictionaries: new UDictionary structure in the
  UValue union.
\end{itemize}

\subsection{Documentation}

\begin{itemize}
\item \refObject{Barrier}
\item \refSlot{Date}{now}
\item \refSlot{Float}{srandom}
\item \refObject{Pattern}
\item \refObject{PubSub}
\item \refObject{PubSub.Subscriber}
\item \refObject{Profiling}
\item \refObject{Semaphore}
\item Trajectories
\item \refObject{TrajectoryGenerator}
\item urbi-image
\item waituntil clauses
\item whenever clauses
\end{itemize}

\section{\urbi SDK 2.0 RC 4}

\subsection{\us}
\subsubsection{Changes}

\begin{itemize}
\item \lstinline|'$id'| replaces id
\item \lstinline|'$type'| replaces type
\item List derives from Orderable.
\end{itemize}

\subsubsection{New objects}
\begin{itemize}
\item \refObject{Location}
\item \refObject{Position}
\end{itemize}

\subsubsection{New features}
\begin{itemize}
\item \refSlot{File}{remove}
\item \refSlot{File}{rename}
\end{itemize}

\subsection{UObjects}

\begin{itemize}
\item The UObject API is now thread-safe: All UVar and UObject
  operations can be performed from any thread.
\item You can request bound functions to be executed asynchronously in
  a different thread by using UBindThreadedFunction instead of
  UBindFunction.
\end{itemize}


\section{\urbi SDK 2.0 RC 3}

\subsection{\us}

\subsubsection{Fixes}
\begin{itemize}
\item local.u works as expected.
\end{itemize}

\subsubsection{Changes}
\begin{itemize}
\item \refSlot{Lobby}{quit} replaces \slot{System}{quit}.
\item \refSlot{Socket}{connect} accepts integers
\item UObject remote notifyChange on USensor variable now works as expected.
\item UObject timers can now be removed with UObject::removeTimer().
\end{itemize}

\subsection{Documentation}

\begin{itemize}
\item Socket provides a complete example.
\item The Naming Standard documents the support classes provided to ease
  creation of the component hierarchy.
\end{itemize}

\section{\urbi SDK 2.0 RC 2}

This release candidate includes many fixes and improvements that are
not reported below. The following list is by no means exhaustive.

\subsection{Optimization}

The urbiscript engine was considerably optimized in both space and
time.

\subsection{urbiscript}

\subsubsection{New constructs}

\begin{itemize}
\item \lstinline|assert { claim1; claim2;... };|

\item \lstinline{every|}

\item \lstinline|break| and \lstinline|continue| are supported in
  \lstinline{every|} loops.

\item \lstinline|for(num)| and \lstinline|for(var i: set)| support the
  \lstinline|for&|, \lstinline{for|} and \lstinline|for;| flavors.

\item \lstinline|for(init; cond; inc)| supports the \lstinline{for|}
  and \lstinline|for;| flavors.

\item non-empty lists of expressions in list literals, in function calls,
  and non-empty lists of function formal arguments may end with a
  trailing optional comma.  For instance:

\begin{urbiunchecked}
function binList(a, b,) { [a, b,] } | binList(1, 2,)
\end{urbiunchecked}

  \noindent
  is equivalent to

\begin{urbiunchecked}
function binList(a, b) { [a, b] } | binList(1, 2)
\end{urbiunchecked}

\item consecutive string literals are joined into a unique string
  literal, as in \Cxx.
\end{itemize}

\subsubsection{New objects}
\begin{itemize}
\item \refObject{Component}, \refObject{Localizer}, \refObject{Interface}:
  naming standard infrastructure classes.
\item \refObject{Date}
\item \refObject{Directory}
\item \refObject{File}
\item \refObject{Finalizable}: objects that call
  \lstinline|finalize()| when they are destroyed.
\item \refObject{InputStream}
\item \refObject{Mutex}
\item \refObject{OutputStream}
\item \refObject{Process}: Start and monitor child processes.
\item \refObject{Regexp}
\item \refObject{Server}: TCP/UDP server socket.
\item \refObject{Socket}: TCP/UDP client socket.
\item \refObject{Timeout}
%%% FIXME: use \refObject when documented.
\item \code{WeakDictionary}, \code{WeakPointer}: Store
  dictionary of objects without increasing their reference count.
\end{itemize}

\subsubsection{New features}
\begin{itemize}
\item asBool
\item \refSlot{Channel}{wall}
\item \refSlot{Dictionary}{size}
\item \refSlot{Global}{evaluate}
\item \refSlot{Group}{each}, \lstinline|Group.each&|
\item Lobby: onDisconnect (actually, an event), remoteIP
  create, received, resendBanner
\item \refSlot{Object}{inspect}
\item String: fromAscii, replace, toAscii
\item System: \lstinline|_exit|, \lstinline|assert_eq|,
  \lstinline|system|, \lstinline|terminate|
\end{itemize}

\subsubsection{Fixes}
\begin{itemize}
\item at constructs do not leak local variables anymore.
\item Each tag now has its enter and leave events.
\item \refSlot{File}{content} reads the whole file.
\item Invalid assignments such as f(x) = n are now refused as expected.
\end{itemize}

\subsubsection{Deprecations}
\begin{itemize}
\item ownsSlot is deprecated in favor of hasSlot/hasLocalSlot.
\item slotNames is deprecated in favor of allSlotName/localSlotNames.
\end{itemize}

\subsubsection{Changes}
\begin{itemize}
\item empty strings, dictionaries and lists are now evaluated as
  "false" in conditions.
\item \refSlot{Dictionary}{asString} does not sort the keys.
\item Dictionaries.[]= returns the assigned value, not the dictionary.
\item Dictionaries.[] raises an exception if the key is missing.
\item Constants is merged into Math.
\item \lstinline|every| no longer goes in background.  Instead of:

\begin{urbiunchecked}
every (1s) echo("foo");
\end{urbiunchecked}

  \noindent
  write (note the change in the separator)

\begin{urbiunchecked}
every (1s) echo("foo"),
\end{urbiunchecked}

  \noindent
  or

\begin{urbiunchecked}
detach({ every (1s) echo("foo"); });
\end{urbiunchecked}

\item Tag: begin and end now simply print the tag name followed by
  \samp{begin} or \samp{end}.
\item System-code is now hidden from the backtraces.
\item \refSlot{Code}{apply}: the call message can be changed by passing it as an extra
  argument.
\end{itemize}

\subsection{UObjects}
\begin{itemize}
\item Handle UObject destruction. To remove an UObject, call the urbiscript
  'destroy()' method. The corresponding C++ instance will be deleted.

\item Add \lstinline|UVar::unnotify()|. When called, it removes all
  UNotifyChange registered with the UVar.

\item Bound functions using UBindFunction can now take arguments of
  type \lstinline|UVar&| and \lstinline|UObject*|. The recommended
  method to pass UVars from urbiscript is now to use
  'camera.getSlot("val")' instead of '"camera.val"'.

\item Add a 0-copy mode for UVars: If UVar::enableBypass(true) is
  called on an UVar, notifyChange on this UVar can recover the
  not-copied data by using \lstinline|UVar.get()|, returning an
  \lstinline|UValue&|. However, the data is only accessible from
  within notifyChange: reading the UVar directly will return nil.

\item Add support for the changed! event on UVars. Code like:

\begin{urbiunchecked}
at(headTouch.val->changed? if headTouch.val) tts.say("ouch");
\end{urbiunchecked}
  \noindent
  will now work. This hook costs one at() per UVar, and can be disabled by
  setting \refSlot{UVar}{hookChanged} to false.

\item Add a statistics-gathering tool. Enable it by calling
  'uobjects.enableStats(true)'. Reset counters by calling
  'uobjects.clearStats' 'uobjects.getStats()' will return a dictionary
  of all bound C++ function called, including timer callbacks, along
  with the average, min, max call durations, and the number of calls.

\item When code registered by a notifyChange throws, the exception is
  intercepted to protect other unrelated callbacks. The throwing
  callback gets removed from the callback list, unless the
  removeThrowingCallbacks on the UVar is false.

\item the environment variable \env{URBI\_UOBJECT\_PATH} is used by
  urbi-launch and urbiscript's loadModule to find uobjects.

\item fixed multiple notifications of event trigger in remote UObjects

\item Many other bug fixes and performance improvements.

\item an exception is now thrown if the C++ init method failed.
\end{itemize}


\subsection{Documentation}

The documentation was fixed, completed, and extended.  Its layout was
also improved.  Changes include, but are not limited to:

\begin{itemize}
\item various programs: \command{urbi}, \command{urbi-launch},
  \command{urbi-send} etc. (\autoref{sec:tools}).
\item environment variables: \env{URBI\_UOBJECT\_PATH}, \env{URBI\_PATH},
  \env{URBI\_ROOT} (\autoref{sec:tools:envvars}).
\item special files \file{global.u}, \file{local.u}
  (\autoref{sec:tools:files}).
\item k1-to-k2: Conversion idioms from urbiscript 1 to urbiscript 2
  (\autoref{sec:k1}).
\item FAQ (\autoref{sec:faq})
  \begin{itemize}
  \item stack exhaustion
  \item at and waituntil: performance considerations
  \end{itemize}
\item Specifications:
  \begin{itemize}
  \item completion of the definition of the control flow constructs
    (\lstinline|every|, \lstinline{every|}, \lstinline|if|,
    \lstinline|for|, \lstinline|loop|)
  \item tools (umake, umake-shared, umake-deepclean, urbi,
    urbi-launch, urbi-send).
  \item \refObject{Boolean}
  \item \refObject{Channel}
  \item \refObject{Date}
  \item \refObject{Dictionary}
  \item \refObject{Exception}
  \item \refObject{File}
  \item \refObject{Kernel1}
  \item \refObject{InputStream}
  \item \refObject{Lazy}
  \item \refObject{Math}
  \item \refObject{Mutex}
  \item \refObject{Regexp}
  \item \refObject{Object}
  \item \refObject{OutputStream}
  \item \refObject{Pair}
  \item \refObject{String}
  \item \refObject{Tag}
  \item \refObject{Timeout}
  \end{itemize}
\item tutorial:
  \begin{itemize}
  \item uobjects
  \end{itemize}
\end{itemize}

\subsection{Various}

\begin{itemize}
\item Text files are converted to DOS end-of-lines for Windows packages.

\item \command{urbi-send} supports \option{--quit}.

\item The files \file{global.u}/\file{local.u} replace
  \file{URBI.INI}/\file{CLIENT.INI}.

\item \command{urbi} supports \option{--quiet} to inhibit the banner.
\end{itemize}

\section{\urbi SDK 2.0 RC 1}

\subsection{Auxiliary programs}

\begin{itemize}
\item \command{urbi-send} no longer displays the server version
  banner, unless given \option{-b}/\option{--banner}.
\item \command{urbi-console} is now called simply \command{urbi}.
\item \command{urbi.bat} should now work out of the box under windows.
\end{itemize}


\subsection{\us}

\subsubsection{Syntax of events}

The keyword \lstinline|emit| is deprecated in favor of \lstinline|!|.

\begin{center}
  \begin{tabular}{|c|c|}
    \hline
    Deprecated & Updated \\
    \hline
    \lstinline|emit e;| &              \lstinline|e!;| \\
    \lstinline|emit e(a);| &           \lstinline|e!(a);| \\
    \lstinline|emit e ~ 1s;| &         \lstinline|e! ~ 1s;| \\
    \lstinline|emit e(a) ~ 1s;| &      \lstinline|e!(a) ~ 1s;| \\
    \hline
  \end{tabular}
\end{center}

The \lstinline|?| construct is changed for symmetry.

\begin{center}
  \begin{tabular}{|c|c|}
    \hline
    Deprecated & Updated \\
    \hline
   \lstinline|at (?e)|                  & \lstinline|at (e?)|\\
   \lstinline|at (?e(var a))|           & \lstinline|at (e?(var a))|\\
   \lstinline|at (?e(var a) if 0 <= a)| & \lstinline|at (e?(var a) if 0 <= a)|\\
   \lstinline|at (?e(2))|               & \lstinline|at (e?(2))|\\
 \end{tabular}
\end{center}

This syntax for sending and receiving is traditional and can be found
in various programming languages.

\subsubsection{Changes}

\begin{itemize}
\item \refSlot{System}{Platform} enhances \refSlot{System}{platform}.  Use
  \refSlot{System}{Platform}.kind instead of \refSlot{System}{platform}.
\end{itemize}

\subsubsection{Fixes}
\begin{itemize}
\item Under some circumstances successful runs could report "at job
  handler exited with exception TerminateException".  This is fixed.

\item Using waituntil on an event with no payload (i.e.,
  \lstinline|waituntil(e?) ...;)| will not cause an internal error
  anymore.
\end{itemize}

\subsection{URBI Remote SDK}

The API for plugged-in UObjects is not thread safe, and never was:
calls to the API must be done only in the very same thread that runs
the Urbi code.  Assertions (run-time failures) are now triggered for
invalid calls.

\subsection{Documentation}

Extended documentation on: Comparable, Orderable.


\section{\urbi SDK 2.0 beta 4}

\subsection{Documentation}

An initial sketch of documentation (a tutorial, and the language and
library specifications) is included.

\subsection{\us}
\subsubsection{Bug fixes}

\begin{description}
\item[Bitwise operations] The native "long unsigned int" type is now
  used for all the bitwise operations (\lstinline|&|, \lstinline{|},
  \lstinline|^|, \lstinline|compl|, \lstinline|<<|, \lstinline|>>|).
  As a consequence it is now an error to pass negative operands to
  these operations.

\item[\refSlot{System}{PackageInfo}] This new object provides version information
  about the Urbi package.  It is also used to ensure that the
  initialization process uses matching Urbi and C++ files.  This
  should prevent accidental mismatches due to incomplete installation
  processes.

\item[Precedence of operator **] In conformance with the usage in
  mathematics, the operator ** now has a stronger precedence than the
  unary operators.  Therefore, as in Perl, Python and others, '-2 ** 2
  == -4' whereas it used to be equal to '4' before (as with GNU bc).

\item[Whenever] Whenever now properly executes the else branch when
  the condition is false.  It used to wait for the condition to be
  verified at least once before.
\end{description}

\subsubsection{Changes}

\begin{description}
\item[\refSlot{String}{asFloat}] This new method has been introduced to transform
  a string to a float.  It raises a PrimitiveError exception if the
  conversion fails:

\begin{urbiscript}
"2.1".asFloat;
[00000002] 2.1
"2.0a".asFloat;
[00000003:error] !!! asFloat: unable to convert to float: "2.0a"
\end{urbiscript}
\end{description}

\subsection{Programs}

\subsubsection{Environment variables}

The environment variable \env{URBI\_ROOT} denotes the directory which
is the root of the tree into which Urbi was installed.  It corresponds
to the "prefix" in GNU Autoconf parlance, and defaults to
\file{/usr/local} under Unix.  urbiscript library files are expected
to be in <URBI\_ROOT>/share/gostai/urbi.

The environment variable URBI\_PATH, which allows to specify a
colon-separated list of directories into which urbiscript files are
looked-up, may extend or override URBI\_ROOT.  Any superfluous colon
denotes the place where the URBI\_ROOT path is taken into account.

\subsubsection{Scripting}

To enable writing (batch) scripts seamlessly in Urbi, \command{urbi-console}
\option{-f}/\option{--fast} is now renamed as \option{-F}/\option{--fast}.
Please, never use short options in batch programs, as they are likely to
change.

Two new option pairs, \option{-e}/\option{--expression} and
\option{-f}/\option{--file}, plus the ability to reach the command line
arguments from Urbi make it possible to write simple batch Urbi programs.
For instance:

\begin{shell}
$ cat demo
#! /usr/bin/env urbi-console
cout << \refSlot{System}{arguments};
shutdown;

$ ./demo 1 2 3 | grep output
[00000004:output] ["1", "2", "3"]
\end{shell}

\subsubsection{urbi-console}

urbi-console is now a simple wrapper around urbi-launch.  Running

\begin{shell}
urbi-console arg1 arg2...
\end{shell}

\noindent
is equivalent to running

\begin{shell}
urbi-launch --start -- arg1 arg2...
\end{shell}


\subsubsection{Auxiliary programs}
The command line interface of \command{urbi-sendbin} has been updated.
\command{urbi-send} now supports \option{-e}/\option{--expression} and
\option{-f}/\option{--file}.  For instance

\begin{urbiunchecked}
$ urbi-send -e 'var x;' -e "x = $value;" -e 'shutdown;'
\end{urbiunchecked}



\section{\urbi SDK 2.0 beta 3}

\subsection{Documentation}

A new document "\refSlot{FAQ}{txt}" addresses the questions most frequently asked
by our users during the beta-test period.

\subsection{\us}

\subsubsection{Fixes}

\begin{itemize}
\item If a file loaded from \file{\refSlot{URBI}{INI}} cannot be found, it is now
  properly reported.
\end{itemize}


\subsubsection{Changes}

\begin{description}
\item["new" syntax revamped]
The syntax "new myObject(myArgs)" has been deprecated and now gives a
warning. The recommended "myObject.new(myArgs)" is suggested.

\item["delete" has been removed]

"delete" was never the right thing to do. A local variable should
not be deleted, and a slot can be removed using "removeSlot".
The construct "delete object" has been removed from the
language.

\item[\_\_HERE\_\_]

The new "\_\_HERE\_\_" pseudo-symbol gives the current position.  It
features three self explanatory slots: "file", "line", and "column".

\item[Operator "()"]

It is now possible to define the "()" operator on objects and have
it called as soon as at least one parameter is given:

\begin{urbiscript}
class A {
  function '()' (x) { echo("A called with " + x) };
}|;
A;
[00000001] A
A();
[00000002] A
A(42);
[00000003] *** A called with 42
\end{urbiscript}

\item["catch(<type> <name>)" syntax removed]

The "catch(<type> <name>)", which was used to catch exceptions if and
only if they inherited <type>, has been removed. This behavior can be
obtained with the more general guard system:

\begin{urbiunchecked}
catch (var e if e.isA(<type>)
{
  ...
}
\end{urbiunchecked}

\item[Pattern matching and guards in catch blocks]

Exception can now be filtered thanks to pattern matching, just like
events. Moreover, the pattern can be followed by the "if" keyword and
an arbitrary guard. The block will catch the exception only if the
guard is true.

\begin{urbiunchecked}
try
{ ... }
catch ("foo") // Catch only the "foo" string
{ ... }
catch (var x if x.isA(Float) && x > 10) // Catch all floats greater than 10
{ ... }
catch (var e)  // Catch any other exception
{ ... }
\end{urbiunchecked}

\item[Parsing of integer literals] The parser could not read integer
  literals greater than 2**31-1.  This constraint has been alleviated,
  and Urbi now accepts integer literals up to 2**63-1.

\item[Display of integer literals] Some large floating point values
  could not be displayed correctly at the top level of the
  interpreter. This limitation has been removed.

\item[Variables binding in event matching]

Parentheses around variables bindings ("var x") are no longer required
in event matching:

\begin{urbiunchecked}
at (?myEvent(var x, var y, 1))
\end{urbiunchecked}

\noindent
instead of:

\begin{urbiunchecked}
at (?myEvent((var x), (var y), 1))
\end{urbiunchecked}

\item[Waituntil and bindings]

Bindings performed in "waituntil" constructs are now available in its
context:

\begin{urbiunchecked}
waituntil(?event(var x));
// x is available
echo (x);
\end{urbiunchecked}

\item["\refSlot{List}{insert}" method]

The "\refSlot{List}{insert}" method now uses an index as its first argument and
inserts the given element before the index position:

\begin{urbiscript}
["a", "b", "c"].insert(1, "foo");
[00000001] ["a", "foo", "b", "c"]
\end{urbiscript}

\item["\refSlot{List}{sort}" method]

The "\refSlot{List}{sort}" method now takes an optional argument, which is a
function to call instead of the "<" operator. Here are two examples
illustrating how to sort strings, depending on whether we want to
be case-sensitive (the default) or not:

\begin{urbiscript}
["foo", "bar", "Baz"].sort;
[00000001] ["Baz", "bar", "foo"]
["foo", "bar", "Baz"].sort(function(x, y) {x.toLower < y.toLower});
[00000002] ["bar", "Baz", "foo"]
\end{urbiscript}

\item["\refSlot{System}{searchPath}" method]

  It is now possible to get the search path for files such as \file{urbi.u}
  or \file{\refSlot{URBI}{INI}} by using \refSlot{System}{searchPath}.

\item["\refSlot{System}{getenv}" method]

"\refSlot{System}{getenv}" now returns "nil" if a variable cannot be found in
the environment instead of "void". This allows you do to things such
as :

\begin{urbiscript}
var ne = \refSlot{System}{getenv}("nonexistent");
if (!ne.isNil) do_something(ne);
\end{urbiscript}

while previously you had to retrieve the environment variable twice,
once to check for its existence and once to get its content.

\item["disown"]

It is now possible to start executing code in background while
dropping all the tags beforehand, including the connection tag. The
code will still continue to execute after the connection that created
it has died.

\item["\refSlot{Object}{removeSlot}"]

The "removeSlot" method now silently accepts non-existing slot
names instead of signaling an error.

\item["\refSlot{Semaphore}{criticalSection}"]

  It is now possible to define a critical section associated with a
  semaphore. The \lstinline|acquire| method will be called at the beginning,
  and if after that the operation is interrupted by any means the
  \lstinline|release| operation will be called before going on. If there are
  no interruption, the \lstinline|release| operation will also be called at
  the end of the callback:

\begin{urbiunchecked}
var s = \refSlot{Semaphore}{new}(1);
s.criticalSection(function () { echo ("In the critical section") });
\end{urbiunchecked}

\item["\refSlot{System}{stats}"]
  Its output is now expressed in seconds rather than milliseconds, for
  consistency with the rest of the kernel.
\end{description}

\subsection{UObjects}

\begin{description}
\item[void]
The error message given to the user trying to cast a void UVar has been
specialized.

Remote bound methods can now return void.


\item[Coroutine interface]

  The functions \lstinline|yield()|, \lstinline|yield_until()|, and
  \lstinline|yield_until_things_changed()| have been added to the
  UObject API. They allow the user to write plugin UObject code that
  behaves like any other coroutine in the kernel: if yield() is called
  regularly, the kernel can continue to work while the user code runs.
  Meaningful implementation for these functions is provided also in
  remote mode: calling yield() will allow the UObject remote library
  to process pending messages from within the user callback.

\item[Remote UObject initialization]

  Remote UObject instantiation is now atomic: the API now ensures that
  all variables and functions bound from the UObject constructor and
  init are visible as soon as the UObject itself is visible. Code
  like:

\begin{urbiunchecked}
waituntil(uobjects.hasSlot("MyRemote")) | var m = \refSlot{MyRemote}{new}();
\end{urbiunchecked}

\noindent
is now safe.
\end{description}

\subsection{Auxiliary programs}

\begin{description}
\item[urbi-launch] Now, options for \command{urbi-launch} are separated from
  options to give to the underlying program (in remote and start modes) by
  using \option{--}. Use \samp{urbi-launch --help} to get the full usage
  information.
\end{description}



\section{\urbi SDK 2.0 beta 2}

\subsection{\us}

\begin{description}
\item["object" and "from" as identifiers]

"object" and "from" are now regular identifiers and can be used as
other names.  For example, it is now legal to declare:

\begin{urbiscript}
var object = 1|;
var from = 1|;
\end{urbiscript}

\item[Hexadecimal literals]
  It is now possible to enter (integral) hexadecimal numbers by
  prefixing them with "0x", as in:

\begin{urbiscript}
0x2a;
[00000001] 42
\end{urbiscript}

Only integral numbers are supported.

%% FIXME: The hexadecimal representation of a number can be obtained by specifying the
%% FIXME: base to \refSlot{Float}{asString}:
%% FIXME:
%% FIXME: \begin{urbiscript}
%% FIXME: 42.asString(16);
%% FIXME: [00000001] "2a"
%% FIXME: // \refSlot{Float}{hex} is a shortcut:
%% FIXME: 42.hex;
%% FIXME: [00000001] "2a"
%% FIXME: \end{urbiscript}
\end{description}

\subsection{Standard library}
\begin{description}

\item["\refSlot{String}{asList}" method]

"String" now has a "asList" method, which can be used transparently
to iterate over the characters of a string:

\begin{urbiscript}
for (var c: "foo") echo (c);
[00000001] *** f
[00000002] *** o
[00000003] *** o
\end{urbiscript}

\item["\refSlot{String}{split}" method]

  It no longer aggregate components by default:

\begin{urbiscript}
"foobar".split("o");
[00000001] ["f", "", "bar"]
\end{urbiscript}

It moreover now supports a list of separators:

\begin{urbiscript}
"a:b;c".split([":", ";"]);
[00000001] ["a", "b", "c"]
\end{urbiscript}

The optional fourth argument indicates a maximum number of splits that
can occur. A negative number, which is the default, corresponds to
"no limit":

\begin{urbiscript}
"a:b:c".split(":", 1);
[00000001] ["a", "b:c"]
"a:b:c".split(":", -1);
[00000002] ["a", "b", "c"]
\end{urbiscript}

The optional third argument indicates whether to keep delimiters in
the resulting list (default: false):

\begin{urbiscript}
"aaa:bbb;ccc".split([":", ";"], -1, true);
[00000001] ["aaa", ":", "bbb", ";", "ccc"]
\end{urbiscript}

The optional fourth argument indicates whether to keep empty elements
(default: true):

\begin{urbiscript}
"foobar".split("o", -1, false, false);
[00000001] ["f", "bar"]
\end{urbiscript}

Calling "split" with no arguments will decompose the string over
\lstinline|" "|, \lstinline|"\t"|, \lstinline|"\n"| and
\lstinline|"\r"|:

\begin{urbiscript}
"  abc  def\tghi\n".split;
[00000001] ["abc", "def", "ghi"]
\end{urbiscript}

%%% FIXME: \item["\refSlot{String}{join}" method]
%%% FIXME:
%%% FIXME:   It is now possible to easily join list members by inserting an
%%% FIXME:   arbitrary string between them:
%%% FIXME:
%%% FIXME: \begin{urbiscript}
%%% FIXME: ", ".join(["abc", "def", "ghi"]);
%%% FIXME: [00000001] "abc, def, ghi"
%%% FIXME: \end{urbiscript}

\item["min" and "max"]

It is now possible to call "min" and "max" on a list. By default, the
"<" comparison operator is used, but one explicit `lower than'
function can be provided as "min" or "max" argument should one be
needed. Here is an example on how to compare strings in case-sensitive
and case-insensitive modes:

\begin{urbiscript}
["the", "brown", "Fox"].min;
[00000001] "Fox"
["the", "brown", "Fox"].min(function (l, r) { l.toLower < r.toLower });
[00000002] "brown"
\end{urbiscript}

Global functions "min" and "max" taking an arbitrary number of
arguments have also been defined. In this case, the default "<"
operator is used for comparison:

\begin{urbiscript}
min(3, 2, 17);
[00000001] 2
\end{urbiscript}

\item[Negative indices]

It is now possible to use negative indices when taking list elements.
For example, -1 designates the last element, and -2 the one before that.

\begin{urbiscript}
["a", "b", "c"][-1];
[00000001] "c"
\end{urbiscript}

\item[Tag names]

  Tags were displayed as \lstinline|Tag_0xADDR| which did not make
  their "name" slot apparent. They are now displayed as "Tag<name>":

\begin{urbiscript}
\refSlot{Tag}{new};
[00000001] Tag<tag_1>
\refSlot{Tag}{new}("mytag");
[00000002] Tag<mytag>
\end{urbiscript}

\item["every" and exceptions]

If an exception is thrown and not caught during the execution of an "every"
block, the "every" expression is stopped and the exception displayed.
\end{description}

\subsection{UObjects}
\begin{description}
\item["UVar::type()" method]

It is now possible to get the type of a "UVar" by calling its "type()"
method, which returns a "UDataType" (see \file{urbi/uvalue.hh} for the
types declarations).
\end{description}

\subsection{Run-time}
\begin{description}
\item[Stack exhaustion check on Windows]

As was done on Linux already, stack exhaustion condition is detected
on Windows, for example in the case of an infinite recursion. In this
case, SchedulingError will be raised and can be caught.

\item[Errors from the trajectory generator are propagated]

If the trajectory generator throws an exception, for example because it
cannot assign the result of its computation to a non-existent variable,
the error is propagated and the generator is stopped:

\begin{urbiscript}
xx = 20 ampli:5 sin:10s;
[00002140:error] !!! lookup failed: xx
\end{urbiscript}
\end{description}

\subsection{Bug fixes}
\begin{description}
\item[Support for Windows shares]

  Previous versions of the kernel could not be launched from a Windows
  remote directory whose name is starting with two slashes such as
  \file{//share/some/dir}.

\item[Implement "UVar::syncValue()" in plugged uobjects]

Calling "syncValue()" on a "UVar" from a plugged UObject resulted in a
link error.  This method is now implemented, but does nothing as there
is nothing to do. However, its presence is required to be able to use
the same UObject in both remote and engine modes.

\item["isdef" works again]

The support for k1 compatibility function "isdef" was broken in the
case of composed names or variables whose content was "void". Note
that we do not recommend using "isdef" at all. Slots related methods
such as "getSlot", "hasSlot", "locateSlot", or "slotNames" have much
cleaner semantics.

\item["\_\_name" macro]

  In some cases, the \lstinline|__name| macro could not be used with
  plugged uobjects, for example in the following expression:

\begin{urbiunchecked}
send(__name + ".val = 1;");
\end{urbiunchecked}
  \noindent
  This has been fixed. \lstinline|__name| contains a valid slot name
  of \lstinline|uobjects|.
\end{description}

\subsection{Auxiliary programs}

The sample programs demonstrating the SDK Remote, i.e., how to write a
client for the Urbi server, have been renamed from \command{urbi*} to
\command{urbi-*}.  For instance \command{urbisend} is now spelled
\command{urbi-send}.

Besides, their interfaces are being overhauled to be more consistent with
the Urbi command-line tool-box.  For instance while \command{urbisend} used
to require exactly two arguments (host-name, file to send), it now supports
options (e.g., \option{--help}, \option{--port} to specify the port etc.),
and as many files as provided on the command line.



%%% Local Variables:
%%% mode: latex
%%% TeX-master: "../urbi-sdk"
%%% ispell-dictionary: "american"
%%% ispell-personal-dictionary: "../urbi.dict"
%%% fill-column: 76
%%% End:
