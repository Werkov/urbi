FILE(GLOB_RECURSE tests RELATIVE ${CMAKE_CURRENT_SOURCE_DIR}/2.x  2.x/*.chk)
#MESSAGE(found ${tests})

FOREACH(infileName ${tests})
  string(REPLACE "." "_" _out ${infileName})
  string(REPLACE "/" "_" _out2 ${_out})
  # We need to check fast mode at this point
  file(READ 2.x/${infileName} _fcontent LIMIT 512)
  #MESSAGE("Got ${_fcontent}")
  string(FIND "${_fcontent}" "//#no-fast" _found)
  set(_fast "")
  if (${_found} EQUAL -1)
    set(_fast "--fast")
  endif()
  MESSAGE("adding  ${infileName} ${_out} ${_out2} ")
  qi_add_test(${_out2} urbi-launch ARGUMENTS -s -- ${_fast} urbi/run-test.u ${infileName})
ENDFOREACH(infileName)
