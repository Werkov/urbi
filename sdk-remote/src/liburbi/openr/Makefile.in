srcdir = @srcdir@
top_srcdir = @top_srcdir@
INSTALL = @INSTALL@
install_sh = @install_sh@
install_sh_DATA = $(install_sh) -c -m 644
install_sh_PROGRAM = $(install_sh) -c
install_sh_SCRIPT = $(install_sh) -c
mkinstalldirs = $(SHELL) $(top_srcdir)/mkinstalldirs
prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = @bindir@
libdir = @libdir@
includedir = @includedir@
datadir = @datadir@

OPENR		= @OPENR_SDK_PATH@
CXX			= $(OPENR)/bin/mipsel-linux-g++
CC			= $(OPENR)/bin/mipsel-linux-gcc
STRIP		= $(OPENR)/bin/mipsel-linux-strip
MKBIN		= $(OPENR)/OPEN_R/bin/mkbin
STUBGEN		= $(OPENR)/OPEN_R/bin/stubgen2
MKBINFLAGS	= -p $(OPENR)
LIBS		= -L$(OPENR)/OPEN_R/lib -lObjectComm -lOPENR -lInternet -lantMCOOP
# library (.a) file creation command
AR_OPENR= $(OPENR)/bin/mipsel-linux-ar rc
# second step in .a creation (use "touch" if not needed)
RANLIB_OPENR= $(OPENR)/bin/mipsel-linux-ranlib


LIBJPEGDIR	= ../../../lib/jpeg-6b
LIBJPEG		= $(LIBJPEGDIR)/libjpeg.mips.a



CXXFLAGS+= \
	-O2 \
	-I. \
	-I$(OPENR)/OPEN_R/include/R4000 \
	-I$(OPENR)/OPEN_R/include/MCOOP \
	-I$(OPENR)/OPEN_R/include \
	-I$(LIBJPEGDIR)	\
	-I$(LIBURBIDIR)

SOURCES =		 uclient.cc		\
			 aiboconnection.cc	\
			 uqueue.cc		\
			 ../uabstractclient.cpp

OBJA = $(SOURCES:.cc=.mips.o)
OBJ = $(OBJA:.cpp=.mips.o)

#
# When OPENR_DEBUG is defined, OSYSDEBUG() is available.
#
CXXFLAGS += -DOPENR_DEBUG



all: liburbi.mips.a

liburbi.mips.a: $(OBJ) $(LIBJPEG) 
	$(RM) liburbi.mips.a
	cp ../../../lib/jpeg-6b/libjpeg.mips.a ./liburbi.mips.a
	$(AR_OPENR) liburbi.mips.a  $(OBJ)
	$(RANLIB_OPENR) liburbi.mips.a

%.mips.o: %.cpp
	$(CXX) $(CXXFLAGS) -o $@ -c $^

%.mips.o: %.cc
	$(CXX) $(CXXFLAGS) -o $@ -c $^

%.mips.o: %.c
	$(CC) $(CXXFLAGS) -o $@ -c $^




$(LIBJPEG):
	$(RM) $(LIBJPEG)
	make -C $(LIBJPEGDIR) -f makefile.aibo

clean:
	make -C $(LIBJPEGDIR) -f makefile.aibo clean
	rm -f *.mips.o *.BIN *.elf *.snap.cc *~ ../*.mips.o

distclean: clean


install:  liburbi.mips.a
	$(mkinstalldirs) $(bindir)
	echo "cp $(datadir)/Makefile.aibo ./ && make -f  ./Makefile.aibo prepare" '$$*' >  $(bindir)/make.openr
	chmod 755  $(bindir)/make.openr
	$(mkinstalldirs) $(libdir)
	$(INSTALL) liburbi.mips.a  $(libdir)
	$(mkinstalldirs) $(datadir)
	$(INSTALL) Makefile.aibo  CLIENT.ocf stub.cfg CLIENT.h CLIENT.cc $(datadir)
	$(mkinstalldirs) $(includedir)/openr
	$(INSTALL) uclient.h aiboconnection.h uconnection.h uqueue.h utypes.h $(includedir)/openr
	$(INSTALL) ../uabstractclient.h  $(includedir)

uninstall:
	$(rm)  $(libdir)/liburbi.mips.a
	$(rm)  $(datadir)/Makefile.aibo
	$(rm)  $(bindir)/make.openr

.PHONY: all install clean
