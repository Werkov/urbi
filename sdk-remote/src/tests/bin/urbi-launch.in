#! @SHELL@
# @configure_input@

set -e

case $VERBOSE in
  (x) set -x;;
esac

: ${EXEEXT='@EXEEXT@'}
: ${abs_top_srcdir='@abs_top_srcdir@'}
: ${sdk_remote_builddir='@abs_top_builddir@'}
: ${program=$sdk_remote_builddir/src/bin/urbi-launch$EXEEXT}

verbose ()
{
  if test -n "$VERBOSE"; then
    echo >&2 "$0: $@"
  fi
}

# The libubbject we load depends on the usage.
verbose "$*"
case " $* " in
  (*' --start '* | *' -s '*)
    # Spawning a new server, which requires a server.  Two cases:
    # this package is part of a kernel package, in which case we
    # should find libuobject.la in it.  Otherwise we hope a kernel
    # was installed, and the real urbi-launch will look for it at the
    # right place.
    if test -f $sdk_remote_builddir/../src/Makefile; then
      libuobjectdir=$sdk_remote_builddir/../src
      # Be sure to find the shipped Urbi files.
      URBI_PATH="$abs_top_srcdir/../share:$sdk_remote_builddir/../share:$URBI_PATH"
      case $(uname -o 2>/dev/null) in
        (Cygwin)
          # We use colon as separators, not semicolon.
          URBI_PATH=$(cygpath -p -w "$URBI_PATH" | sed -e 's/;/:/g')
          ;;
      esac
      export URBI_PATH
    fi
    ;;
  (*)
     libuobjectdir=$sdk_remote_builddir/src/libuobject;;
esac

if test -n "$libuobjectdir"; then
  libuobject=$libuobjectdir/.libs
  case $(uname -o 2>/dev/null) in
    (Cygwin)
      # Using slashes is not a problem.  But not starting with the
      # drive letter is.
      libuobject=$(cygpath -w "$libuobject");;
  esac
  set x -c "$libuobject" "$@"
  shift
fi

# Find the noninstalled libport libraries.
libport_builddir=$sdk_remote_builddir/libport
# Careful, do not add directory containing libuobject.
for d in $libport_builddir/lib/*/.libs               \
         $sdk_remote_builddir/*/.libs              \
         $sdk_remote_builddir/src/liburbi/.libs
do
  ds="$ds$d:"
done
export LD_LIBRARY_PATH=$ds$LD_LIBRARY_PATH
export DYLD_LIBRARY_PATH=$ds$DYLD_LIBRARY_PATH
verbose "LD_LIBRARY_PATH=$LD_LIBRARY_PATH"
verbose "DYLD_LIBRARY_PATH=$DYLD_LIBRARY_PATH"

export URBI_ROOT_LIBJPEG=$sdk_remote_builddir/jpeg/.libs/libjpeg
export URBI_ROOT_LIBPORT=$libport_builddir/lib/libport/.libs/libport
export URBI_ROOT_LIBSCHED=$libport_builddir/lib/sched/.libs/libsched
export URBI_ROOT_LIBSERIALIZE=$libport_builddir/lib/serialize/.libs/libserialize
export URBI_ROOT_LIBURBI=$sdk_remote_builddir/src/liburbi/.libs/liburbi

verbose "running $program $*"
exec "$program" "$@"

# Local Variables:
# mode: shell-script
# End:
