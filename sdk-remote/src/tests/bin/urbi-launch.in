#! @SHELL@
# @configure_input@

set -e

case $VERBOSE in
  (x) set -x;;
esac

: ${EXEEXT='@EXEEXT@'}
: ${abs_top_srcdir='@abs_top_srcdir@'}
: ${abs_top_builddir='@abs_top_builddir@'}
: ${program=$abs_top_builddir/src/urbi-launch$EXEEXT}

verbose ()
{
  if test -n "$VERBOSE"; then
    echo >&2 "$0: $@"
  fi
}

# The libubbject we load depends on the usage.
verbose "$*"
case " $* " in
  (*' --start '*)
     # Spawning a new server, which requires a server.  Two cases:
     # this package is part of a kernel package, in which case we
     # should find libuobject.la in it.  Otherwise we hope a kernel
     # was installed, and the real urbi-launch will look for it at the
     # right place.
     if test -f $abs_top_builddir/../src/Makefile; then
       libuobjectdir=$abs_top_builddir/../src
       # Be sure to find the shipped Urbi files.
       URBI_PATH="$abs_top_srcdir/../share:$abs_top_builddir/../share:$URBI_PATH"
       export URBI_PATH
     fi
     # Unfortunately, ltdl does not seem to look into the *.la
     # file to find the dependencies, so load them first.
     for var in LD_LIBRARY_PATH DYLD_LIBRARY_PATH
     do
       eval "val=\$$var"
       val=$abs_top_builddir/../src/lib/sched/.libs:$val
       eval "$var=\$val"
       verbose "$var=$val"
       export $var
     done
     ;;
  (*)
     libuobjectdir=$abs_top_builddir/src/libuobject;;
esac

if test -n "$libuobjectdir"; then
  set x -c "$libuobjectdir/libuobject" "$@"
  shift
fi

verbose "running $program $*"
exec "$program" "$@"

# Local Variables:
# mode: shell-script
# End:
