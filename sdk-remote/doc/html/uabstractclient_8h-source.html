<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>liburbi-cpp: uabstractclient.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex">  <form class="search" action="search.php" method="get">
<a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a>  | <span class="search"><u>S</u>earch&nbsp;for&nbsp;<input class="search" type="text" name="query" value="" size="20" accesskey="s"/></span></form></div>
<h1>uabstractclient.h</h1><a href="uabstractclient_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 
00024 <span class="preprocessor">#ifndef UABSTRACTCLIENT_H</span>
00025 <span class="preprocessor"></span><span class="preprocessor">#define UABSTRACTCLIENT_H</span>
00026 <span class="preprocessor"></span>
00027 <span class="preprocessor">#include &lt;stdio.h&gt;</span>      
00028 <span class="preprocessor">#include &lt;sys/types.h&gt;</span>  
00029 <span class="preprocessor">#include &lt;string.h&gt;</span>
00030 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00031 <span class="preprocessor">#include &lt;stdarg.h&gt;</span>
00032 <span class="preprocessor">#include &lt;list&gt;</span>
00033 <span class="preprocessor">#include &lt;iostream&gt;</span>
00034 <span class="keyword">using</span> std::list;
00035 <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> byte; 
00036 
<a name="l00037"></a><a class="code" href="uabstractclient_8h.html#a3">00037</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="uabstractclient_8h.html#a3">URBI_BUFLEN</a>    = 128000 ; 
<a name="l00038"></a><a class="code" href="uabstractclient_8h.html#a4">00038</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="uabstractclient_8h.html#a4">URBI_PORT</a>          = 54000  ; 
<a name="l00039"></a><a class="code" href="uabstractclient_8h.html#a5">00039</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="uabstractclient_8h.html#a5">URBI_MAX_TAG_LENGTH</a> = 64; 
00040 
00041 
00042 
00044 
<a name="l00050"></a><a class="code" href="uabstractclient_8h.html#a47">00050</a> <span class="keyword">enum</span> <a class="code" href="uabstractclient_8h.html#a47">UCallbackAction</a> {
00051   URBI_CONTINUE=0,
00052   URBI_REMOVE
00053 };
00054 
00055 <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> UCallbackID;
00056 
00057 
00058 
00059 
00060 <span class="keyword">class </span>UCallbackList;
00061 <span class="preprocessor">#define UINVALIDCALLBACKID 0</span>
00062 <span class="preprocessor"></span>
00063 <span class="keyword">enum</span> UMessageType {
00064   MESSAGE_DOUBLE,
00065   MESSAGE_STRING,
00066   MESSAGE_BINARY,
00067   MESSAGE_SYSTEM,
00068   MESSAGE_ERROR,
00069   MESSAGE_UNKNOWN
00070 };
00071 
00072 <span class="keyword">enum</span> UBinaryMessageType {
00073   BINARYMESSAGE_NONE,
00074   BINARYMESSAGE_UNKNOWN,
00075   BINARYMESSAGE_IMAGE,
00076   BINARYMESSAGE_SOUND
00077 };
00078 
<a name="l00079"></a><a class="code" href="uabstractclient_8h.html#a50">00079</a> <span class="keyword">enum</span> <a class="code" href="uabstractclient_8h.html#a50">UImageFormat</a> {
00080   <a class="code" href="uabstractclient_8h.html#a50a25">IMAGE_RGB</a>=1,     
00081   <a class="code" href="uabstractclient_8h.html#a50a26">IMAGE_YCbCr</a>=2,   
00082   <a class="code" href="uabstractclient_8h.html#a50a27">IMAGE_JPEG</a>=3,    
00083   <a class="code" href="uabstractclient_8h.html#a50a28">IMAGE_PPM</a>=4      
00084 };
00085 
00086 
00087 <span class="keyword">enum</span> USoundFormat {
00088   SOUND_RAW,
00089   SOUND_WAV,
00090   SOUND_MP3,
00091   SOUND_OGG
00092 };
00093 
00094 <span class="keyword">enum</span> USoundSampleFormat {
00095   SAMPLE_SIGNED=1,
00096   SAMPLE_UNSIGNED=2
00097 };
00098 
00099 
<a name="l00101"></a><a class="code" href="classUImage.html">00101</a> <span class="keyword">class </span><a class="code" href="classUImage.html">UImage</a> {
00102  <span class="keyword">public</span>:
<a name="l00103"></a><a class="code" href="classUImage.html#o0">00103</a>   <span class="keywordtype">char</span>                  *data;            
<a name="l00104"></a><a class="code" href="classUImage.html#o1">00104</a>   <span class="keywordtype">int</span>                   size;             
<a name="l00105"></a><a class="code" href="classUImage.html#o3">00105</a>   <span class="keywordtype">int</span>                   width, height;    
00106   <a class="code" href="uabstractclient_8h.html#a50">UImageFormat</a>          imageFormat;
00107 };
00108 
<a name="l00110"></a><a class="code" href="classUSound.html">00110</a> <span class="keyword">class </span><a class="code" href="classUSound.html">USound</a> {
00111  <span class="keyword">public</span>:
<a name="l00112"></a><a class="code" href="classUSound.html#o0">00112</a>  <span class="keywordtype">char</span>                  *data;            
<a name="l00113"></a><a class="code" href="classUSound.html#o1">00113</a>  <span class="keywordtype">int</span>                   size;             
<a name="l00114"></a><a class="code" href="classUSound.html#o2">00114</a>  <span class="keywordtype">int</span>                   channels;         
<a name="l00115"></a><a class="code" href="classUSound.html#o3">00115</a>  <span class="keywordtype">int</span>                   rate;             
<a name="l00116"></a><a class="code" href="classUSound.html#o4">00116</a>  <span class="keywordtype">int</span>                   sampleSize;       
<a name="l00117"></a><a class="code" href="classUSound.html#o5">00117</a>  USoundFormat          soundFormat;      
<a name="l00118"></a><a class="code" href="classUSound.html#o6">00118</a>  USoundSampleFormat    sampleFormat;     
00119 
00120 
00121    <span class="comment">// USound() : data(0), size(0), channels(1), rate(16000), sampleSize(2), sampleFormat(SAMPLE_SIGNED) {}</span>
00122  <span class="keywordtype">bool</span> operator ==(<span class="keyword">const</span> <a class="code" href="classUSound.html">USound</a> &amp;b)<span class="keyword"> const </span>{<span class="keywordflow">return</span> !memcmp(<span class="keyword">this</span>, &amp;b, <span class="keyword">sizeof</span>(<a class="code" href="classUSound.html">USound</a>));}
00123 };
00124 
<a name="l00126"></a><a class="code" href="classUBinary.html">00126</a> <span class="keyword">class </span><a class="code" href="classUBinary.html">UBinary</a> {
00127  <span class="keyword">public</span>:
<a name="l00128"></a><a class="code" href="classUBinary.html#o0">00128</a>   <span class="keywordtype">void</span>                  *data;             
<a name="l00129"></a><a class="code" href="classUBinary.html#o1">00129</a>    <span class="keywordtype">char</span>                  *message;         
00130    <span class="keywordtype">int</span>                   size;
00131 };
00132 
00133 <span class="keyword">class </span><a class="code" href="classUAbstractClient.html">UAbstractClient</a>; 
<a name="l00135"></a><a class="code" href="classUMessage.html">00135</a> <span class="keyword">class </span><a class="code" href="classUMessage.html">UMessage</a> {
00136  <span class="keyword">public</span>:
00137   
<a name="l00138"></a><a class="code" href="classUMessage.html#o0">00138</a>   <a class="code" href="classUAbstractClient.html">UAbstractClient</a>    &amp;client;       
<a name="l00139"></a><a class="code" href="classUMessage.html#o1">00139</a>   <span class="keywordtype">int</span>                timestamp;     
<a name="l00140"></a><a class="code" href="classUMessage.html#o2">00140</a>   <span class="keywordtype">char</span>               *tag;          
00141  
00142   
00143   UMessageType       type;
00144   UBinaryMessageType binaryType;
00145   
00146   
00147 
00148   <span class="keyword">union </span>{
<a name="l00150"></a><a class="code" href="classUMessage.html#o5">00150</a>     <span class="keywordtype">double</span>        doubleValue;
00151 
<a name="l00153"></a><a class="code" href="classUMessage.html#o6">00153</a>     <span class="keywordtype">char</span>          *stringValue; 
00154     
<a name="l00156"></a><a class="code" href="classUMessage.html#o7">00156</a>     <span class="keywordtype">char</span>          *systemValue;
00157 
<a name="l00159"></a><a class="code" href="classUMessage.html#o8">00159</a>     <span class="keywordtype">char</span>          *errorValue;
00160 
00161     
<a name="l00163"></a><a class="code" href="classUMessage.html#o9">00163</a>     <span class="keywordtype">char</span>          *message;
00164 
00165     <a class="code" href="classUSound.html">USound</a> sound;
00166     <a class="code" href="classUImage.html">UImage</a> image;
00167     <a class="code" href="classUBinary.html">UBinary</a> binary;
00168     
00169   };
00170 
00172   <a class="code" href="classUMessage.html">UMessage</a>(<a class="code" href="classUAbstractClient.html">UAbstractClient</a> &amp; client, <span class="keywordtype">int</span> timestamp,  <span class="keywordtype">char</span> *tag, <span class="keywordtype">char</span> *message, 
00173            <span class="keywordtype">void</span> *buffer=NULL, <span class="keywordtype">int</span> length=0);
00174 
00176   <a class="code" href="classUMessage.html">UMessage</a>(<span class="keyword">const</span> <a class="code" href="classUMessage.html">UMessage</a> &amp;source, <span class="keywordtype">bool</span> alocate=<span class="keyword">true</span>);
00177 
00179   ~<a class="code" href="classUMessage.html">UMessage</a>();
00180 
00181  <span class="keyword">private</span>: 
00182   <span class="keywordtype">bool</span> alocated;
00183 };
00184 
00185 
00186 
<a name="l00188"></a><a class="code" href="uabstractclient_8h.html#a7">00188</a> <span class="keyword">typedef</span> <a class="code" href="uabstractclient_8h.html#a47">UCallbackAction</a> (*UCallback)             (<span class="keyword">const</span> <a class="code" href="classUMessage.html">UMessage</a> &amp;msg);
00189 
00190 
00191 <span class="keyword">typedef</span> <a class="code" href="uabstractclient_8h.html#a47">UCallbackAction</a> (*UCustomCallback)       (<span class="keywordtype">void</span> * callbackData, 
00192                                                  <span class="keyword">const</span> <a class="code" href="classUMessage.html">UMessage</a> &amp;msg);
00193 
00194 
00195 
00196 
00197 <span class="comment">//used internaly</span>
00198 <span class="keyword">class </span>UCallbackWrapper;
00199 
00200 <span class="comment">//used internaly</span>
00201 <span class="keyword">class </span>UCallbackInfo {
00202  <span class="keyword">public</span>:
00203   <span class="keywordtype">char</span> tag[URBI_MAX_TAG_LENGTH];
00204   UCallbackWrapper &amp; callback;
00205   <span class="keywordtype">int</span> id;
00206   <span class="keywordtype">bool</span> operator ==(<span class="keywordtype">int</span> <span class="keywordtype">id</span>)<span class="keyword"> const </span>{<span class="keywordflow">return</span> <span class="keywordtype">id</span>==this-&gt;id;}
00207   UCallbackInfo(UCallbackWrapper &amp;w): callback(w) {}
00208 };
00209 <span class="comment">//used internaly</span>
00210 <span class="keyword">class </span>UClientStreambuf;
00211 
00212 
00214 
<a name="l00229"></a><a class="code" href="classUAbstractClient.html">00229</a> <span class="keyword">class </span><a class="code" href="classUAbstractClient.html">UAbstractClient</a>: <span class="keyword">public</span> std::ostream {
00230  <span class="keyword">public</span>:
00232    <a class="code" href="classUAbstractClient.html#a0">UAbstractClient</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *_host,
00233                    <span class="keywordtype">int</span> _port = <a class="code" href="uabstractclient_8h.html#a4">URBI_PORT</a>,
00234                    <span class="keywordtype">int</span> _buflen = <a class="code" href="uabstractclient_8h.html#a3">URBI_BUFLEN</a>);
00235 
00236   <span class="keyword">virtual</span> ~<a class="code" href="classUAbstractClient.html">UAbstractClient</a>();
00237 
<a name="l00239"></a><a class="code" href="classUAbstractClient.html#a2">00239</a>   <span class="keywordtype">int</span> <a class="code" href="classUAbstractClient.html#a2">error</a>() {<span class="keywordflow">return</span>(rc);};
00240   
00241 
00242   <span class="comment">// Sending</span>
00243   
<a name="l00245"></a><a class="code" href="classUAbstractClient.html#a3">00245</a>   <span class="keywordtype">int</span> <a class="code" href="classUAbstractClient.html#a3">send</a>() { <a class="code" href="classUAbstractClient.html#a8">endPack</a>(); <span class="keywordflow">return</span> 0;}
00246   
00248   <span class="keywordtype">int</span> <a class="code" href="classUAbstractClient.html#a3">send</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* format,...);
00249   
00251   <span class="keywordtype">int</span> <a class="code" href="classUAbstractClient.html#a5">sendBin</a>(<span class="keyword">const</span> <span class="keywordtype">void</span>*, <span class="keywordtype">int</span> len);
00252 
00254   <span class="keywordtype">int</span> <a class="code" href="classUAbstractClient.html#a5">sendBin</a>(<span class="keyword">const</span> <span class="keywordtype">void</span>*, <span class="keywordtype">int</span> len,<span class="keyword">const</span> <span class="keywordtype">char</span> * header,...);
00255   
00257   <span class="keywordtype">int</span> <a class="code" href="classUAbstractClient.html#a7">startPack</a>();
00258 
00260   <span class="keywordtype">int</span> <a class="code" href="classUAbstractClient.html#a8">endPack</a>();
00261 
00263   <span class="keywordtype">int</span> <a class="code" href="classUAbstractClient.html#a9">pack</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>*,...);
00264   
00266   <span class="keywordtype">int</span> <a class="code" href="classUAbstractClient.html#a10">vpack</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>*,va_list args);
00267 
00269   <span class="keywordtype">int</span> <a class="code" href="classUAbstractClient.html#a11">sendFile</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> * filename);
00270   
00272   UCallbackID <a class="code" href="classUAbstractClient.html#a12">sendCommand</a>(UCallback ,<span class="keyword">const</span> <span class="keywordtype">char</span>*,...);
00273  
00275   UCallbackID <a class="code" href="classUAbstractClient.html#a12">sendCommand</a>(UCustomCallback ,<span class="keywordtype">void</span> *,<span class="keyword">const</span> <span class="keywordtype">char</span>*,...);
00276 
00277 
00278 
00280   <span class="keywordtype">int</span> <a class="code" href="classUAbstractClient.html#a14">sendSound</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> * device, <span class="keyword">const</span> <a class="code" href="classUSound.html">USound</a> &amp;sound, <span class="keyword">const</span> <span class="keywordtype">char</span> * tag=0);
00281   
00283   <span class="keywordtype">int</span> <a class="code" href="classUAbstractClient.html#a15">putFile</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> * localName, <span class="keyword">const</span> <span class="keywordtype">char</span> * remoteName=0);
00284 
00286   <span class="keywordtype">int</span> <a class="code" href="classUAbstractClient.html#a15">putFile</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> * buffer, <span class="keywordtype">int</span> length, <span class="keyword">const</span> <span class="keywordtype">char</span> * remoteName);
00287 
00288 
00289 
00290   <span class="comment">// Receiving</span>
00291   
00293     UCallbackID <a class="code" href="classUAbstractClient.html#a17">setCallback</a>(UCallbackWrapper &amp; callback, <span class="keyword">const</span> <span class="keywordtype">char</span> * tag);
00294     
00296     UCallbackID <a class="code" href="classUAbstractClient.html#a18">setErrorCallback</a>(UCallbackWrapper &amp; callback);
00297 
00299      UCallbackID <a class="code" href="classUAbstractClient.html#a19">setWildcardCallback</a>(UCallbackWrapper &amp; callback);
00300 
00302  UCallbackID <a class="code" href="classUAbstractClient.html#a17">setCallback</a>(UCallback ,<span class="keyword">const</span> <span class="keywordtype">char</span>* tag);
00303 
00305   UCallbackID <a class="code" href="classUAbstractClient.html#a17">setCallback</a>(UCustomCallback ,<span class="keywordtype">void</span> * callbackData,<span class="keyword">const</span> <span class="keywordtype">char</span>* tag);
00306 
00308   <span class="keyword">template</span>&lt;<span class="keyword">class</span> C&gt;                                         UCallbackID <a class="code" href="classUAbstractClient.html#a17">setCallback</a>(C&amp; ref, 
00309              UCallbackAction (C::*)(                 <span class="keyword">const</span> <a class="code" href="classUMessage.html">UMessage</a> &amp;),                 <span class="keyword">const</span> <span class="keywordtype">char</span> * tag);
00310   <span class="keyword">template</span>&lt;<span class="keyword">class</span> C, <span class="keyword">class</span> P1&gt;                               UCallbackID <a class="code" href="classUAbstractClient.html#a17">setCallback</a>(C&amp; ref, 
00311              UCallbackAction (C::*)(P1 ,             <span class="keyword">const</span> <a class="code" href="classUMessage.html">UMessage</a> &amp;), P1,             <span class="keyword">const</span> <span class="keywordtype">char</span> * tag);
00312   <span class="keyword">template</span>&lt;<span class="keyword">class</span> C, <span class="keyword">class</span> P1, <span class="keyword">class</span> P2&gt;                     UCallbackID <a class="code" href="classUAbstractClient.html#a17">setCallback</a>(C&amp; ref, 
00313              UCallbackAction (C::*)(P1 , P2,         <span class="keyword">const</span> <a class="code" href="classUMessage.html">UMessage</a> &amp;), P1, P2,         <span class="keyword">const</span> <span class="keywordtype">char</span> * tag);
00314   <span class="keyword">template</span>&lt;<span class="keyword">class</span> C, <span class="keyword">class</span> P1, <span class="keyword">class</span> P2, <span class="keyword">class</span> P3&gt;           UCallbackID <a class="code" href="classUAbstractClient.html#a17">setCallback</a>(C&amp; ref, 
00315              UCallbackAction (C::*)(P1 , P2, P3,     <span class="keyword">const</span> <a class="code" href="classUMessage.html">UMessage</a> &amp;), P1, P2, P3,     <span class="keyword">const</span> <span class="keywordtype">char</span> * tag);
00316   <span class="keyword">template</span>&lt;<span class="keyword">class</span> C, <span class="keyword">class</span> P1, <span class="keyword">class</span> P2, <span class="keyword">class</span> P3, <span class="keyword">class</span> P4&gt; UCallbackID <a class="code" href="classUAbstractClient.html#a17">setCallback</a>(C&amp; ref, 
00317              UCallbackAction (C::*)(P1 , P2, P3, P4, <span class="keyword">const</span> <a class="code" href="classUMessage.html">UMessage</a> &amp;), P1, P2, P3, P4, <span class="keyword">const</span> <span class="keywordtype">char</span> * tag);
00318   
00320   <span class="keywordtype">int</span> <a class="code" href="classUAbstractClient.html#a27">getAssociatedTag</a>(UCallbackID <span class="keywordtype">id</span>, <span class="keywordtype">char</span> * tag);
00321     
00322   
00324   <span class="keywordtype">int</span> <a class="code" href="classUAbstractClient.html#a28">deleteCallback</a>(UCallbackID callBackID);
00325 
00326 
00327 
00329   <span class="keywordtype">void</span> <a class="code" href="classUAbstractClient.html#a29">makeUniqueTag</a>(<span class="keywordtype">char</span> * tag);
00330 
00332   <span class="keywordtype">void</span> <a class="code" href="classUAbstractClient.html#a30">notifyCallbacks</a>(<span class="keyword">const</span> <a class="code" href="classUMessage.html">UMessage</a> &amp;msg);
00333 
00335   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classUAbstractClient.html#a31">printf</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> * format, ...)=0;
00336   
00338   <span class="keyword">virtual</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="classUAbstractClient.html#a32">getCurrentTime</a>()=0;
00339 
00341   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classUAbstractClient.html#a33">lockSend</a>()=0;
00342 
00344   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classUAbstractClient.html#a34">unlockSend</a>()=0;
00345 
<a name="l00347"></a><a class="code" href="classUAbstractClient.html#a35">00347</a>   <span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="classUAbstractClient.html#a35">getServerName</a>() {<span class="keywordflow">return</span> host;}
00348 
00349  <span class="keyword">protected</span>:
00351   <span class="keywordtype">void</span> <a class="code" href="classUAbstractClient.html#b0">processRecvBuffer</a>();
00352   
00354   <span class="keyword">virtual</span> <span class="keywordtype">int</span> <a class="code" href="classUAbstractClient.html#b1">effectiveSend</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> * buffer, <span class="keywordtype">int</span> size)=0;
00355 
00357   <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="classUAbstractClient.html#b2">canSend</a>(<span class="keywordtype">int</span> size)=0;
00358   
00360   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classUAbstractClient.html#b3">lockList</a>()=0;
00361 
00363   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classUAbstractClient.html#b4">unlockList</a>()=0;
00364   
00365   
00366 
00367   
00368   UCallbackID <a class="code" href="classUAbstractClient.html#b5">addCallback</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> * tag, UCallbackWrapper &amp;w); 
00369   
<a name="l00370"></a><a class="code" href="classUAbstractClient.html#p0">00370</a>   <span class="keywordtype">char</span>           *host;              
<a name="l00371"></a><a class="code" href="classUAbstractClient.html#p1">00371</a>   <span class="keywordtype">int</span>            port;               
<a name="l00372"></a><a class="code" href="classUAbstractClient.html#p2">00372</a>   <span class="keywordtype">int</span>            buflen;             
<a name="l00373"></a><a class="code" href="classUAbstractClient.html#p3">00373</a>   <span class="keywordtype">int</span>            rc;                 
00374   
<a name="l00375"></a><a class="code" href="classUAbstractClient.html#p4">00375</a>   <span class="keywordtype">char</span>           *recvBuffer;        
<a name="l00376"></a><a class="code" href="classUAbstractClient.html#p5">00376</a>   <span class="keywordtype">int</span>            recvBufferPosition; 
00377   
00378  <span class="keyword">private</span>:
00379   <span class="keywordtype">void</span>           *binaryBuffer;          
00380   <span class="keywordtype">int</span>            binaryBufferPosition;   
00381   <span class="keywordtype">int</span>            binaryBufferLength;     
00382   <span class="keywordtype">int</span>            endOfHeaderPosition;    
00383   <span class="keywordtype">char</span>           currentTag[URBI_MAX_TAG_LENGTH];  
00384   <span class="keywordtype">char</span>           *currentCommand;                 
00385   <span class="keywordtype">int</span>            currentTimestamp;
00386 
00387 
00388   <span class="keywordtype">char</span>           *sendBuffer;            
00389 
00390   std::list&lt;UCallbackInfo&gt;callbackList;
00391   <span class="keywordtype">int</span>            uid;                    
00392   std::ostream     *outputStream;
00393   
00394   <span class="keyword">friend</span> <span class="keyword">class </span>UClientStreambuf;
00395 };
00396 
00397 
00399 <span class="keywordtype">int</span> <a class="code" href="uabstractclient_8h.html#a35">convertRGBtoYCrCb</a>  (<span class="keyword">const</span> byte* source, <span class="keywordtype">int</span> sourcelen, byte* dest);
00400 <span class="keywordtype">int</span> convertYCrCbtoRGB  (<span class="keyword">const</span> byte* source, <span class="keywordtype">int</span> sourcelen, byte* dest);
00401 <span class="keywordtype">int</span> convertJPEGtoYCrCb (<span class="keyword">const</span> byte* source, <span class="keywordtype">int</span> sourcelen, byte* dest, 
00402                        <span class="keywordtype">int</span> &amp;size);
00403 <span class="keywordtype">int</span> convertJPEGtoRGB   (<span class="keyword">const</span> byte* source, <span class="keywordtype">int</span> sourcelen, byte* dest, 
00404                        <span class="keywordtype">int</span> &amp;size);
00405 
00406 <span class="comment">//sound format conversion functions.</span>
00407 <span class="keywordtype">int</span> <a class="code" href="uabstractclient_8h.html#a39">convert</a>(<span class="keyword">const</span> <a class="code" href="classUSound.html">USound</a> &amp;source, <a class="code" href="classUSound.html">USound</a> &amp;destination);
00408 
00409 
00410 
00411 
00412 
00413 
00414 
00415 <span class="keyword">class </span>UCallbackWrapper {
00416  <span class="keyword">public</span>:
00417   <span class="keyword">virtual</span> <a class="code" href="uabstractclient_8h.html#a47">UCallbackAction</a> operator ()(<span class="keyword">const</span> <a class="code" href="classUMessage.html">UMessage</a> &amp;)=0;
00418   <span class="keyword">virtual</span> ~UCallbackWrapper() {}
00419 };
00420 
00421 
00422 <span class="keyword">template</span>&lt;<span class="keyword">class</span> elementT&gt; <span class="keyword">class </span>ElementTraits {
00423  <span class="keyword">public</span>:
00424   <span class="keyword">typedef</span> elementT  Element;
00425   <span class="keyword">typedef</span> elementT&amp; ElementReference;
00426   <span class="keyword">typedef</span> <span class="keyword">const</span> elementT&amp; ConstElementReference;
00427 };
00428 
00429 <span class="keyword">template</span>&lt;<span class="keyword">class</span> elementT&gt; <span class="keyword">class </span>ElementTraits&lt;elementT&amp;&gt; {
00430  <span class="keyword">public</span>:
00431   <span class="keyword">typedef</span> elementT  Element;
00432   <span class="keyword">typedef</span> elementT&amp; ElementReference;
00433   <span class="keyword">typedef</span> <span class="keyword">const</span> elementT&amp; ConstElementReference;
00434 };
00435 
00436 
00437 
00438 <span class="keyword">class </span>UCallbackWrapperF : <span class="keyword">public</span> UCallbackWrapper {
00439   <a class="code" href="uabstractclient_8h.html#a7">UCallback</a> cb;
00440  <span class="keyword">public</span>:
00441   UCallbackWrapperF(UCallback cb) : cb(cb) {}
00442   <span class="keyword">virtual</span> <a class="code" href="uabstractclient_8h.html#a47">UCallbackAction</a> operator ()(<span class="keyword">const</span> <a class="code" href="classUMessage.html">UMessage</a> &amp; msg) {<span class="keywordflow">return</span> cb(msg);}
00443   <span class="keyword">virtual</span> ~UCallbackWrapperF() {}
00444 };
00445 
00446 <span class="keyword">class </span>UCallbackWrapperCF : <span class="keyword">public</span> UCallbackWrapper {
00447   UCustomCallback cb;
00448   <span class="keywordtype">void</span> * cbData;
00449  <span class="keyword">public</span>:
00450   UCallbackWrapperCF(UCustomCallback cb, <span class="keywordtype">void</span> * cbData) : cb(cb), cbData(cbData) {}
00451   <span class="keyword">virtual</span> <a class="code" href="uabstractclient_8h.html#a47">UCallbackAction</a> operator ()(<span class="keyword">const</span> <a class="code" href="classUMessage.html">UMessage</a> &amp; msg) {<span class="keywordflow">return</span> cb(cbData, msg);}
00452   <span class="keyword">virtual</span> ~UCallbackWrapperCF() {}
00453 };
00454 
00455 <span class="keyword">template</span>&lt;<span class="keyword">class</span> C&gt; <span class="keyword">class </span>UCallbackWrapper0 : <span class="keyword">public</span> UCallbackWrapper {
00456   C&amp; instance;
00457   <a class="code" href="uabstractclient_8h.html#a47">UCallbackAction</a> (C::*func)(<span class="keyword">const</span> <a class="code" href="classUMessage.html">UMessage</a> &amp;);
00458  <span class="keyword">public</span>:
00459   UCallbackWrapper0(C&amp; instance, UCallbackAction (C::*func)(<span class="keyword">const</span> <a class="code" href="classUMessage.html">UMessage</a> &amp;))
00460     : instance(instance), func(func) {}
00461   <span class="keyword">virtual</span> <a class="code" href="uabstractclient_8h.html#a47">UCallbackAction</a> operator ()(<span class="keyword">const</span> <a class="code" href="classUMessage.html">UMessage</a> &amp; msg) {<span class="keywordflow">return</span> (instance.*func)(msg);}
00462   <span class="keyword">virtual</span> ~UCallbackWrapper0() {}
00463 };
00464 
00465 <span class="keyword">template</span>&lt;<span class="keyword">class</span> C, <span class="keyword">class</span> P1&gt; <span class="keyword">class </span>UCallbackWrapper1 : <span class="keyword">public</span> UCallbackWrapper {
00466   C&amp; instance;
00467   <span class="keyword">typename</span> ElementTraits&lt;P1&gt;::Element  p1;
00468   <a class="code" href="uabstractclient_8h.html#a47">UCallbackAction</a> (C::*funcPtr)(P1, <span class="keyword">const</span> <a class="code" href="classUMessage.html">UMessage</a> &amp;);
00469  <span class="keyword">public</span>:
00470   UCallbackWrapper1(C&amp; instance, UCallbackAction (C::*func)(P1, <span class="keyword">const</span> <a class="code" href="classUMessage.html">UMessage</a> &amp;), P1 p1)
00471     : instance(instance), funcPtr(func), p1(p1) {}
00472   <span class="keyword">virtual</span> <a class="code" href="uabstractclient_8h.html#a47">UCallbackAction</a> operator ()(<span class="keyword">const</span> <a class="code" href="classUMessage.html">UMessage</a> &amp; msg) {<span class="keywordflow">return</span> (instance.*funcPtr)(p1, msg);}
00473    <span class="keyword">virtual</span> ~UCallbackWrapper1() {}
00474 };
00475 
00476 <span class="keyword">template</span>&lt;<span class="keyword">class</span> C, <span class="keyword">class</span> P1, <span class="keyword">class</span> P2&gt; <span class="keyword">class </span>UCallbackWrapper2 : <span class="keyword">public</span> UCallbackWrapper {
00477   C&amp; instance;
00478   <span class="keyword">typename</span> ElementTraits&lt;P1&gt;::Element  p1;
00479   <span class="keyword">typename</span> ElementTraits&lt;P2&gt;::Element  p2;
00480   <a class="code" href="uabstractclient_8h.html#a47">UCallbackAction</a> (C::*func)(P1, P2, <span class="keyword">const</span> <a class="code" href="classUMessage.html">UMessage</a> &amp;);
00481  <span class="keyword">public</span>:
00482   UCallbackWrapper2(C&amp; instance, UCallbackAction (C::*func)(P1, P2, <span class="keyword">const</span> <a class="code" href="classUMessage.html">UMessage</a> &amp;), P1 p1, P2 p2)
00483     : instance(instance), func(func), p1(p1), p2(p2) {}
00484   <span class="keyword">virtual</span> <a class="code" href="uabstractclient_8h.html#a47">UCallbackAction</a> operator ()(<span class="keyword">const</span> <a class="code" href="classUMessage.html">UMessage</a> &amp; msg) {<span class="keywordflow">return</span> (instance.*func)(p1, p2, msg);}
00485   <span class="keyword">virtual</span> ~UCallbackWrapper2() {}
00486 };
00487 
00488 
00489 <span class="keyword">template</span>&lt;<span class="keyword">class</span> C, <span class="keyword">class</span> P1, <span class="keyword">class</span> P2, <span class="keyword">class</span> P3&gt; <span class="keyword">class </span>UCallbackWrapper3 : <span class="keyword">public</span> UCallbackWrapper {
00490   C&amp; instance;
00491   <span class="keyword">typename</span> ElementTraits&lt;P1&gt;::Element  p1;
00492   <span class="keyword">typename</span> ElementTraits&lt;P2&gt;::Element  p2;
00493   <span class="keyword">typename</span> ElementTraits&lt;P3&gt;::Element  p3;
00494   <a class="code" href="uabstractclient_8h.html#a47">UCallbackAction</a> (C::*func)(P1, P2, P3, <span class="keyword">const</span> <a class="code" href="classUMessage.html">UMessage</a> &amp;);
00495  <span class="keyword">public</span>:
00496   UCallbackWrapper3(C&amp; instance, UCallbackAction (C::*func)(P1, P2, P3, <span class="keyword">const</span> <a class="code" href="classUMessage.html">UMessage</a> &amp;), P1 p1, P2 p2, P3 p3)
00497     : instance(instance), func(func), p1(p1), p2(p2), p3(p3) {}
00498   <span class="keyword">virtual</span> <a class="code" href="uabstractclient_8h.html#a47">UCallbackAction</a> operator ()(<span class="keyword">const</span> <a class="code" href="classUMessage.html">UMessage</a> &amp; msg) {<span class="keywordflow">return</span> (instance.*func)(p1, p2, p3, msg);}
00499    <span class="keyword">virtual</span> ~UCallbackWrapper3() {}
00500 };
00501 
00502 
00503 <span class="keyword">template</span>&lt;<span class="keyword">class</span> C, <span class="keyword">class</span> P1, <span class="keyword">class</span> P2, <span class="keyword">class</span> P3, <span class="keyword">class</span> P4&gt; <span class="keyword">class </span>UCallbackWrapper4 : <span class="keyword">public</span> UCallbackWrapper {
00504   C&amp; instance;
00505   <span class="keyword">typename</span> ElementTraits&lt;P1&gt;::Element  p1;
00506   <span class="keyword">typename</span> ElementTraits&lt;P2&gt;::Element  p2;
00507   <span class="keyword">typename</span> ElementTraits&lt;P3&gt;::Element  p3;
00508   <span class="keyword">typename</span> ElementTraits&lt;P4&gt;::Element  p4;
00509   <a class="code" href="uabstractclient_8h.html#a47">UCallbackAction</a> (C::*func)(P1, P2, P3, P4, <span class="keyword">const</span> <a class="code" href="classUMessage.html">UMessage</a> &amp;);
00510  <span class="keyword">public</span>:
00511   UCallbackWrapper4(C&amp; instance, UCallbackAction (C::*func)(P1, P2, P3, P4, <span class="keyword">const</span> <a class="code" href="classUMessage.html">UMessage</a> &amp;), P1 p1, P2 p2, P3 p3, P4 p4)
00512     : instance(instance), func(func), p1(p1), p2(p2), p3(p3), p4(p4) {}
00513   <span class="keyword">virtual</span> <a class="code" href="uabstractclient_8h.html#a47">UCallbackAction</a> operator ()(<span class="keyword">const</span> <a class="code" href="classUMessage.html">UMessage</a> &amp; msg) {<span class="keywordflow">return</span> (instance.*func)(p1, p2, p3, p4, msg);}
00514   <span class="keyword">virtual</span> ~UCallbackWrapper4() {}
00515 };
00516 
00517 <span class="comment">//overloaded callback generators</span>
00518 
00519 <span class="keyword">inline</span> UCallbackWrapper&amp; callback(UCallback cb) {
00520   <span class="keywordflow">return</span> *<span class="keyword">new</span> UCallbackWrapperF(cb);
00521 }
00522 <span class="keyword">inline</span> UCallbackWrapper&amp; callback(UCustomCallback cb, <span class="keywordtype">void</span> * data) {
00523   <span class="keywordflow">return</span> *<span class="keyword">new</span> UCallbackWrapperCF(cb, data);
00524 }
00525 
00526 
00527 <span class="keyword">template</span>&lt;<span class="keyword">class</span> C&gt;                                          UCallbackWrapper&amp; callback(C&amp; ref, 
00528         UCallbackAction (C::*func)(                 <span class="keyword">const</span> <a class="code" href="classUMessage.html">UMessage</a> &amp;)     ) {
00529   <span class="keywordflow">return</span> *<span class="keyword">new</span> UCallbackWrapper0&lt;C&gt;(ref, func);
00530 }
00531 
00532 <span class="keyword">template</span>&lt;<span class="keyword">class</span> C, <span class="keyword">class</span> P1&gt;                                UCallbackWrapper&amp; callback(C&amp; ref, 
00533         UCallbackAction (C::*func)(P1,              <span class="keyword">const</span> <a class="code" href="classUMessage.html">UMessage</a> &amp;), P1 p1) {
00534   <span class="keywordflow">return</span> *<span class="keyword">new</span> UCallbackWrapper1&lt;C, P1&gt;(ref, func, p1);
00535 }
00536 
00537 <span class="keyword">template</span>&lt;<span class="keyword">class</span> C, <span class="keyword">class</span> P1, <span class="keyword">class</span> P2&gt;                      UCallbackWrapper&amp; callback(C&amp; ref, 
00538         UCallbackAction (C::*func)(P1, P2,           <span class="keyword">const</span> <a class="code" href="classUMessage.html">UMessage</a> &amp;), P1 p1, P2 p2) {
00539   <span class="keywordflow">return</span> *<span class="keyword">new</span> UCallbackWrapper2&lt;C, P1, P2&gt;(ref, func, p1, p2);
00540 }
00541 
00542 <span class="keyword">template</span>&lt;<span class="keyword">class</span> C, <span class="keyword">class</span> P1, <span class="keyword">class</span> P2, <span class="keyword">class</span> P3&gt;            UCallbackWrapper&amp; callback(C&amp; ref, 
00543         UCallbackAction (C::*func)(P1, P2, P3,           <span class="keyword">const</span> <a class="code" href="classUMessage.html">UMessage</a> &amp;), P1 p1, P2 p2, P3 p3) {
00544   <span class="keywordflow">return</span> *<span class="keyword">new</span> UCallbackWrapper3&lt;C, P1, P2, P3&gt;(ref, func, p1, p2, p3);
00545 }
00546 
00547 <span class="keyword">template</span>&lt;<span class="keyword">class</span> C, <span class="keyword">class</span> P1, <span class="keyword">class</span> P2, <span class="keyword">class</span> P3, <span class="keyword">class</span> P4&gt;  UCallbackWrapper&amp; callback(C&amp; ref, 
00548         UCallbackAction (C::*func)(P1, P2, P3, P4,           <span class="keyword">const</span> <a class="code" href="classUMessage.html">UMessage</a> &amp;), P1 p1, P2 p2, P3 p3, P4 p4) {
00549   <span class="keywordflow">return</span> *<span class="keyword">new</span> UCallbackWrapper4&lt;C, P1, P2, P3, P4&gt;(ref, func, p1, p2, p3, p4);
00550 }
00551 
00552 
00553 
00554 
00555 
00556 
00557 
00558 
00559 <span class="comment">//old-style addCallback, depreciated</span>
<a name="l00560"></a><a class="code" href="classUAbstractClient.html#a22">00560</a> <span class="keyword">template</span>&lt;<span class="keyword">class</span> C&gt;                                          UCallbackID <a class="code" href="classUAbstractClient.html#a17">UAbstractClient::setCallback</a>(C&amp; ref, 
00561              UCallbackAction (C::*func)(                 <span class="keyword">const</span> <a class="code" href="classUMessage.html">UMessage</a> &amp;),                 <span class="keyword">const</span> <span class="keywordtype">char</span> * tag) {
00562   <span class="keywordflow">return</span> <a class="code" href="classUAbstractClient.html#b5">addCallback</a>(tag, *<span class="keyword">new</span> UCallbackWrapper0&lt;C&gt;(ref, func));
00563 }
00564 
00565 <span class="keyword">template</span>&lt;<span class="keyword">class</span> C, <span class="keyword">class</span> P1&gt;                               UCallbackID <a class="code" href="classUAbstractClient.html#a17">UAbstractClient::setCallback</a>(C&amp; ref, 
00566              UCallbackAction (C::*func)(P1 ,             <span class="keyword">const</span> <a class="code" href="classUMessage.html">UMessage</a> &amp;), P1 p1,          <span class="keyword">const</span> <span class="keywordtype">char</span> * tag){
00567   <span class="keywordflow">return</span> <a class="code" href="classUAbstractClient.html#b5">addCallback</a>(tag, *<span class="keyword">new</span> UCallbackWrapper1&lt;C, P1&gt;(ref, func, p1));
00568 }
00569 
00570 <span class="keyword">template</span>&lt;<span class="keyword">class</span> C, <span class="keyword">class</span> P1, <span class="keyword">class</span> P2&gt;                     UCallbackID <a class="code" href="classUAbstractClient.html#a17">UAbstractClient::setCallback</a>(C&amp; ref, 
00571              UCallbackAction (C::*func)(P1 , P2,         <span class="keyword">const</span> <a class="code" href="classUMessage.html">UMessage</a> &amp;), P1 p1, P2 p2,         <span class="keyword">const</span> <span class="keywordtype">char</span> * tag){
00572   <span class="keywordflow">return</span> <a class="code" href="classUAbstractClient.html#b5">addCallback</a>(tag, *<span class="keyword">new</span> UCallbackWrapper2&lt;C, P1, P2&gt;(ref, func, p1, p2));
00573 }
00574 
00575 <span class="keyword">template</span>&lt;<span class="keyword">class</span> C, <span class="keyword">class</span> P1, <span class="keyword">class</span> P2, <span class="keyword">class</span> P3&gt;           UCallbackID <a class="code" href="classUAbstractClient.html#a17">UAbstractClient::setCallback</a>(C&amp; ref, 
00576              UCallbackAction (C::*func)(P1 , P2, P3,     <span class="keyword">const</span> <a class="code" href="classUMessage.html">UMessage</a> &amp;), P1 p1 , P2 p2, P3 p3,     <span class="keyword">const</span> <span class="keywordtype">char</span> * tag){
00577   <span class="keywordflow">return</span> <a class="code" href="classUAbstractClient.html#b5">addCallback</a>(tag, *<span class="keyword">new</span> UCallbackWrapper3&lt;C, P1, P2, P3&gt;(ref, func, p1, p2, p3));
00578 }
00579 
00580 <span class="keyword">template</span>&lt;<span class="keyword">class</span> C, <span class="keyword">class</span> P1, <span class="keyword">class</span> P2, <span class="keyword">class</span> P3, <span class="keyword">class</span> P4&gt; UCallbackID <a class="code" href="classUAbstractClient.html#a17">UAbstractClient::setCallback</a>(C&amp; ref, 
00581              UCallbackAction (C::*func)(P1 , P2, P3, P4, <span class="keyword">const</span> <a class="code" href="classUMessage.html">UMessage</a> &amp;), P1 p1, P2 p2, P3 p3, P4 p4, <span class="keyword">const</span> <span class="keywordtype">char</span> * tag){
00582   <span class="keywordflow">return</span> <a class="code" href="classUAbstractClient.html#b5">addCallback</a>(tag, *<span class="keyword">new</span> UCallbackWrapper4&lt;C, P1, P2, P3, P4&gt;(ref, func, p1, p2, p3, p4));
00583 }
00584 
00585 
00587 
00602 <span class="preprocessor">#if defined(LIBURBI_NOARMOR)</span>
00603 <span class="preprocessor"></span><span class="preprocessor">#if !defined(__GNUC__)</span>
00604 <span class="preprocessor"></span><span class="preprocessor">#error "as far as we know, your compiler does not support the __VA_ARGS__ C preprocessor extension, feature unavailable"</span>
00605 <span class="preprocessor"></span><span class="preprocessor">#else</span>
00606 <span class="preprocessor"></span><span class="preprocessor">#define URBI(...) ((urbi::getDefaultClient()==0)? std::cerr : (*urbi::getDefaultClient())) &lt;&lt; #__VA_ARGS__</span>
00607 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00608 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00609"></a><a class="code" href="uabstractclient_8h.html#a1">00609</a> <span class="preprocessor"></span><span class="preprocessor">#define URBI(a) urbi::unarmorAndSend(#a)</span>
00610 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00611 <span class="preprocessor"></span>
<a name="l00612"></a><a class="code" href="namespaceurbi.html">00612</a> <span class="keyword">namespace </span>urbi {
00613   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> semicolon = <span class="charliteral">';'</span>;
00614   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> pipe = <span class="charliteral">'|'</span>;
00615   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> parallel = <span class="charliteral">'&amp;'</span>;
00616   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> comma = <span class="charliteral">','</span>;
00617 };
00618 <span class="preprocessor">#endif // UABSTRACTCLIENT_H</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Sep 21 08:43:19 2005 for liburbi-cpp by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
