#!/bin/sh

set -xe

cd "$DIR_BUILD"

make_()
{
  make DESTDIR="$DIR_INSTALL" "$@"
}

make_twice_()
{
  make_ -j$JOBS "$@" || make_ VERBOSE=1 "$@"
}

check ()
{
  make_twice_ installcheck "$@"
}

check -C tests TESTS_DIRS=0.x
check -C doc
check -C tests TESTS_DIRS=2.x
check -C tests TESTS_DIRS=1.x
check -C tests TESTS_DIRS=uob/plug
check -C tests TESTS_DIRS=uob/remote
check -C tests TESTS_DIRS=uob/rtp
check -C tests TESTS_DIRS=uob/java
check -C tests TESTS_DIRS=demo
check -C tests TESTS_DIRS=@ros

# fsm.u is not installed, cannot installcheck.  Windows cannot run
# properly with non-installed libraries.
case $BUILDFARM_OS in
  (windows);;
  (*) make_twice_ check -C tests TESTS_DIRS=@fsm;;
esac
